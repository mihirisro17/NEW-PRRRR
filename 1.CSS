this is my html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitoring Dashboard</title>

    <!-- CSS -->
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->
    <link rel="stylesheet" href="{{ url_prefix }}/static/css/style.css">
    <link rel="stylesheet" href="{{ url_prefix }}/static/css/fontawesome.min.css">

    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.min.css') }}"> -->

    <!-- Chart.js for Memory Pie Chart -->
    <script src="{{ url_prefix }}/static/js/lib/chart.min.js"></script>
    <script src="{{ url_prefix }}/static/js/lib/chart.js"></script>
    <script src="{{ url_prefix }}/static/js/lib/highcharts.js"></script>
    <script src="{{ url_prefix }}/static/js/lib/exporting.js"></script>
    <script src="{{ url_prefix }}/static/js/lib/boost.js"></script>

    <!-- Highcharts for Analytics Charts -->
    <!-- <script src="{{ url_for('static', filename='js/lib/chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/highcharts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/exporting.js') }}"></script>
    <script src="/home/sac/Mihir/server_monitoring_new/app/static/js/lib/boost.js"></script> -->
</head>

<body class="theme-dark">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-server"></i>
            <h2>Server Monitor</h2>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-page="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="servers">
                <i class="fas fa-server"></i>
                <span>All Servers</span>
            </a>
            <a href="#" class="nav-item" data-page="alerts">
                <i class="fas fa-bell"></i>
                <span>Alerts</span>
                <span class="badge" id="alert-badge">0</span>
            </a>
            <a href="#" class="nav-item" data-page="analytics">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
            <a href="#" class="nav-item" data-page="user-tracking">
                <i class="fas fa-users"></i>
                <span>User Tracking</span>
            </a>
            <a href="#" class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <i class="far fa-user-circle"></i>
                <span>{{ user }}</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>

            <div class="header-center">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="serverSearch" placeholder="Search servers...">
                </div>
            </div>

            <div class="header-right">
                <div class="theme-switcher">
                    <button class="theme-btn" data-theme="dark" title="Dark Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="theme-btn" data-theme="light" title="Light Theme">
                        <i class="fas fa-sun"></i>
                    </button>
                    <button class="theme-btn" data-theme="blue" title="Blue Theme">
                        <i class="fas fa-water"></i>
                    </button>
                    <button class="theme-btn" data-theme="purple" title="Purple Theme">
                        <i class="fas fa-gem"></i>
                    </button>
                    <button class="theme-btn" data-theme="green" title="Green Theme">
                        <i class="fas fa-leaf"></i>
                    </button>
                </div>

                <div class="time-display">
                    <i class="far fa-clock"></i>
                    <span id="current-time">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Page -->
        <div class="page-content active" id="dashboard-page">
            <!-- Stats Overview -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-icon online">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-servers">0</h3>
                        <p>Total Servers</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="online-servers">0</h3>
                        <p>Online</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="alert-servers">0</h3>
                        <p>Alerts</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon info">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="avg-cpu">0%</h3>
                        <p>Avg CPU</p>
                    </div>
                </div>
            </div>

            <!-- Server Groups Container -->
            <div id="servers-container"></div>
        </div>

        <!-- Servers Page -->
        <div class="page-content" id="servers-page">
            <h2 class="page-title">All Servers</h2>
            <div id="all-servers-list"></div>
        </div>
        <!-- Alerts Page -->
        <div class="page-content" id="alerts-page">
            <h2 class="page-title">System Alerts</h2>
            <div id="alerts-container"></div>
        </div>

        <!-- Analytics Page with Date Range -->
        <!-- Analytics Page with Date Range -->
        <div class="page-content" id="analytics-page">
            <div class="analytics-header">
                <h2 class="page-title">System Analytics</h2>
                <div class="date-range-picker">
                    <label>From:</label>
                    <input type="date" id="date-from" />
                    <label>To:</label>
                    <input type="date" id="date-to" />
                    <button class="btn-primary" onclick="loadAnalyticsByDateRange()">
                        <i class="fas fa-search"></i> Apply Filter
                    </button>
                </div>
            </div>
            <div class="analytics-grid">
                <div class="chart-container">
                    <h3><i class="fas fa-microchip"></i> CPU Usage Trend</h3>
                    <div id="cpuChart"></div>
                </div>
                <div class="chart-container">
                    <h3><i class="fas fa-memory"></i> Memory Usage Trend</h3>
                    <div id="memoryChart"></div>
                </div>
            </div>
        </div>

        <!-- User Tracking Page -->
        <div class="page-content" id="user-tracking-page">
            <div class="analytics-header">
                <h2 class="page-title">User SSH Activity Tracking</h2>
                <button class="btn-primary" onclick="loadUserTracking()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div id="user-tracking-container"></div>
        </div>

        <!-- Settings Page -->
        <div class="page-content" id="settings-page">
            <h2 class="page-title">Settings</h2>
            <div class="settings-container">
                <div class="setting-group">
                    <h3>Refresh Interval</h3>
                    <select id="refresh-interval">
                        <option value="5">5 seconds</option>
                        <option value="10">10 seconds</option>
                        <option value="30">30 seconds</option>
                        <option value="60">1 minute</option>
                    </select>
                </div>

                <div class="setting-group">
                    <h3>Alert Thresholds</h3>
                    <div class="threshold-inputs">
                        <label>
                            CPU Warning (%):
                            <input type="number" id="cpu-warning" value="70" min="0" max="100">
                        </label>
                        <label>
                            CPU Critical (%):
                            <input type="number" id="cpu-critical" value="90" min="0" max="100">
                        </label>
                        <label>
                            Memory Warning (%):
                            <input type="number" id="mem-warning" value="75" min="0" max="100">
                        </label>
                        <label>
                            Memory Critical (%):
                            <input type="number" id="mem-critical" value="90" min="0" max="100">
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>Display Options</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-offline" checked>
                        Show offline servers
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="compact-view">
                        Compact view
                    </label>
                </div>

                <button class="btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>
    </main>

    <!-- Server Detail Modal -->
    <div id="server-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="modal-server-name">Server Details</h2>
                <button class="close-btn" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="overview">
                    <i class="fas fa-eye"></i> Overview
                </div>
                <div class="tab" data-tab="storage">
                    <i class="fas fa-hdd"></i> Storage
                </div>
                <div class="tab" data-tab="processes">
                    <i class="fas fa-list"></i> Processes
                </div>
                <div class="tab" data-tab="services">
                    <i class="fas fa-cogs"></i> Services
                </div>
                <div class="tab" data-tab="ssh">
                    <i class="fas fa-terminal"></i> SSH Sessions
                </div>
            </div>

            <div id="overview-tab" class="tab-content active"></div>
            <div id="storage-tab" class="tab-content"></div>
            <div id="processes-tab" class="tab-content"></div>
            <div id="services-tab" class="tab-content"></div>
            <div id="ssh-tab" class="tab-content"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Monitor Script -->
    <!-- <script src="{{ url_for('static', filename='js/monitor.js') }}"></script> -->
    <script src="{{ url_prefix }}/static/js/monitor.js"></script>
</body>

</html>



this is my css

/* ==================== CSS Variables for Themes ==================== */
:root {
    --sidebar-width: 250px;
    --header-height: 70px;
    --accent-rgb: 102, 126, 234;
}

/* Dark Theme (Default) */
.theme-dark {
    --bg-primary: #0f1419;
    --bg-secondary: #1a1f2e;
    --bg-tertiary: #252b3b;
    --text-primary: #e4e6eb;
    --text-secondary: #9ca3af;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --border: rgba(255, 255, 255, 0.1);
    --shadow: rgba(0, 0, 0, 0.3);
}

/* Light Theme */
.theme-light {
    --bg-primary: #ffffff;
    --bg-secondary: #f3f4f6;
    --bg-tertiary: #e5e7eb;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --border: rgba(0, 0, 0, 0.1);
    --shadow: rgba(0, 0, 0, 0.1);
}

/* Blue Theme */
.theme-blue {
    --bg-primary: #0a1929;
    --bg-secondary: #132f4c;
    --bg-tertiary: #1e4976;
    --text-primary: #e3f2fd;
    --text-secondary: #90caf9;
    --accent: #42a5f5;
    --accent-hover: #1e88e5;
    --success: #26a69a;
    --warning: #ffa726;
    --danger: #ef5350;
    --border: rgba(144, 202, 249, 0.2);
    --shadow: rgba(0, 0, 0, 0.4);
}

/* Purple Theme */
.theme-purple {
    --bg-primary: #1a0933;
    --bg-secondary: #2d1b4e;
    --bg-tertiary: #462672;
    --text-primary: #f3e5f5;
    --text-secondary: #ce93d8;
    --accent: #ab47bc;
    --accent-hover: #8e24aa;
    --success: #66bb6a;
    --warning: #ffca28;
    --danger: #ef5350;
    --border: rgba(206, 147, 216, 0.2);
    --shadow: rgba(0, 0, 0, 0.4);
}

/* Green Theme */
.theme-green {
    --bg-primary: #0d1f12;
    --bg-secondary: #1b3320;
    --bg-tertiary: #2d4a35;
    --text-primary: #e8f5e9;
    --text-secondary: #a5d6a7;
    --accent: #66bb6a;
    --accent-hover: #4caf50;
    --success: #81c784;
    --warning: #ffb74d;
    --danger: #e57373;
    --border: rgba(165, 214, 167, 0.2);
    --shadow: rgba(0, 0, 0, 0.4);
}

/* ==================== Base Styles ==================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all 0.3s ease;
}

/* ==================== Sidebar ==================== */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: var(--sidebar-width);
    height: 100vh;
    background: var(--bg-secondary);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    z-index: 1000;
}

.sidebar.collapsed {
    transform: translateX(-100%);
}

.sidebar-header {
    padding: 2rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid var(--border);
}

.sidebar-header i {
    font-size: 2rem;
    color: var(--accent);
}

.sidebar-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
}

.sidebar-nav {
    flex: 1;
    padding: 1rem 0;
    overflow-y: auto;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.2s ease;
    position: relative;
}

.nav-item:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.nav-item.active {
    background: var(--bg-tertiary);
    color: var(--accent);
    border-left: 3px solid var(--accent);
}

.nav-item i {
    font-size: 1.2rem;
    width: 24px;
}

.nav-item .badge {
    margin-left: auto;
    background: var(--danger);
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.sidebar-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text-secondary);
}

.user-info i {
    font-size: 1.5rem;
}

/* ==================== Main Content ==================== */
.main-content {
    margin-left: var(--sidebar-width);
    min-height: 100vh;
    transition: margin-left 0.3s ease;
}

.main-content.expanded {
    margin-left: 0;
}

/* ==================== Header ==================== */
.header {
    height: var(--header-height);
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 2rem;
    gap: 2rem;
    position: sticky;
    top: 0;
    z-index: 999;
}

.sidebar-toggle {
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background 0.2s;
}

.sidebar-toggle:hover {
    background: var(--bg-tertiary);
}

.header-center {
    flex: 1;
}

.search-box {
    max-width: 500px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: var(--bg-tertiary);
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    border: 1px solid var(--border);
}

.search-box i {
    color: var(--text-secondary);
}

.search-box input {
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 1rem;
    width: 100%;
    outline: none;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.theme-switcher {
    display: flex;
    gap: 0.5rem;
    background: var(--bg-tertiary);
    padding: 0.5rem;
    border-radius: 12px;
}

.theme-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    width: 36px;
    height: 36px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.theme-btn:hover {
    background: var(--bg-primary);
    color: var(--accent);
}

.theme-btn.active {
    background: var(--accent);
    color: white;
}

.time-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
}

/* ==================== Page Content ==================== */
.page-content {
    display: none;
    padding: 2rem;
}

.page-content.active {
    display: block;
}

.page-title {
    font-size: 2rem;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

/* ==================== Stats Overview ==================== */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px var(--shadow);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
}

.stat-icon.online {
    background: rgba(59, 130, 246, 0.2);
    color: var(--accent);
}

.stat-icon.success {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success);
}

.stat-icon.danger {
    background: rgba(239, 68, 68, 0.2);
    color: var(--danger);
}

.stat-icon.info {
    background: rgba(245, 158, 11, 0.2);
    color: var(--warning);
}

.stat-content h3 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.stat-content p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ==================== Server Groups ==================== */
.server-group {
    margin-bottom: 3rem;
}

.group-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
}

.group-header i {
    font-size: 1.5rem;
    color: var(--accent);
}

.group-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
}

.server-count {
    margin-left: auto;
    background: var(--bg-tertiary);
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.servers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
}

/* ==================== Server Card ==================== */
.server-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.server-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--accent);
    transform: scaleY(0);
    transition: transform 0.3s ease;
}

.server-card:hover::before {
    transform: scaleY(1);
}

.server-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px var(--shadow);
    border-color: var(--accent);
}

.server-card.offline {
    opacity: 0.6;
}

.server-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.server-header h3 {
    font-size: 1.2rem;
    font-weight: 600;
}

.status-badge {
    padding: 0.4rem 0.9rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-badge.online {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success);
}

.status-badge.offline {
    background: rgba(239, 68, 68, 0.2);
    color: var(--danger);
}

.server-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.stat {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.stat-value {
    font-size: 1.3rem;
    font-weight: 700;
}

.stat-value.critical {
    color: var(--danger);
}

.stat-value.warning {
    color: var(--warning);
}

.stat-value.normal {
    color: var(--success);
}

/* ==================== Modal ==================== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
}

.modal.show {
    display: flex;
}

.modal-content {
    background: var(--bg-secondary);
    border-radius: 20px;
    width: 90%;
    max-width: 900px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px var(--shadow);
    animation: modalSlideIn 0.3s ease-out;
}

.modal-content.large {
    max-width: 1200px;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border);
}

.modal-header h2 {
    font-size: 1.5rem;
}

.close-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 1.5rem;
    cursor: pointer;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.close-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    transform: rotate(90deg);
}

/* ==================== Tabs ==================== */
.tabs {
    display: flex;
    gap: 0.5rem;
    padding: 1rem 2rem 0;
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
}

.tab {
    padding: 0.75rem 1.5rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tab:hover {
    color: var(--text-primary);
    background: var(--bg-tertiary);
}

.tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
}

.tab-content {
    display: none;
    padding: 2rem;
}

.tab-content.active {
    display: block;
}

/* ==================== Overview Tab ==================== */
.overview-stats {
    display: grid;
    gap: 2rem;
}

.stat-section {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid var(--border);
}

.stat-section h3 {
    font-size: 1.2rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--accent);
}

.stat-box {
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 8px;
    margin-top: 0.75rem;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 700;
}

.stat-bar {
    height: 8px;
    background: var(--bg-primary);
    border-radius: 4px;
    margin-top: 0.75rem;
    overflow: hidden;
}

.stat-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent-hover));
    border-radius: 4px;
    transition: width 0.3s ease;
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

/* ==================== Memory Chart ==================== */
.memory-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: center;
}

.memory-stats {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.memory-stat {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.memory-label {
    width: 16px;
    height: 16px;
    border-radius: 4px;
}

.memory-total {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
    font-weight: 600;
}

/* ==================== Tables ==================== */
.stats-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.stats-table thead {
    background: var(--bg-secondary);
}

.stats-table th,
.stats-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

.stats-table th {
    color: var(--accent);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
}

.stats-table tr:hover {
    background: var(--bg-secondary);
}

.stats-table code {
    background: var(--bg-primary);
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

/* Alert Section */
.alert-section {
    border-left: 4px solid var(--warning);
    background: rgba(245, 158, 11, 0.1);
}

.warning-row {
    background: rgba(245, 158, 11, 0.05);
}

/* ==================== Storage Grid ==================== */
.storage-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.storage-card {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid var(--border);
}

.storage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.storage-info {
    display: grid;
    gap: 0.75rem;
    margin: 1rem 0;
}

.storage-stat {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
}

.storage-stat .label {
    color: var(--text-secondary);
}

.storage-bar {
    height: 8px;
    background: var(--bg-primary);
    border-radius: 4px;
    margin: 1rem 0;
    overflow: hidden;
}

.storage-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
}

.storage-percent {
    text-align: center;
    font-weight: 700;
    font-size: 1.2rem;
}

/* ==================== Alerts Container ==================== */
.alerts-container {
    display: grid;
    gap: 1rem;
}

.alert-item {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-left: 4px solid var(--danger);
    padding: 1.5rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.alert-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: rgba(239, 68, 68, 0.2);
    color: var(--danger);
}

.alert-content h4 {
    margin-bottom: 0.5rem;
}

.alert-content p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ==================== Analytics ==================== */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
}

.chart-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    padding: 2rem;
    border-radius: 16px;
}

.chart-container h3 {
    margin-bottom: 1.5rem;
}

/* ==================== Settings ==================== */
.settings-container {
    max-width: 800px;
}

.setting-group {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    padding: 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
}

.setting-group h3 {
    margin-bottom: 1.5rem;
    color: var(--accent);
}

.setting-group select,
.setting-group input[type="number"] {
    width: 100%;
    padding: 0.75rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 1rem;
}

.threshold-inputs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.threshold-inputs label {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    color: var(--text-secondary);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.btn-primary {
    background: var(--accent);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.2s;
}

.btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow);
}

/* ==================== Context Menu ==================== */
.context-menu {
    display: none;
    position: fixed;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 0.5rem;
    box-shadow: 0 8px 24px var(--shadow);
    z-index: 3000;
    min-width: 200px;
}

.context-menu.show {
    display: block;
}

.menu-item {
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.menu-item:hover {
    background: var(--bg-tertiary);
}

.menu-item i {
    color: var(--accent);
}

/* ==================== Loading Overlay ==================== */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 4000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 1.5rem;
}

.loading-overlay.show {
    display: flex;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* ==================== Responsive Design ==================== */
@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar.show {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .servers-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
}

@media (max-width: 768px) {
    .header {
        padding: 0 1rem;
    }
    
    .stats-overview {
        grid-template-columns: 1fr;
    }
    
    .servers-grid {
        grid-template-columns: 1fr;
    }
    
    .theme-switcher {
        flex-wrap: wrap;
    }
    
    .memory-container {
        grid-template-columns: 1fr;
    }
    
    .analytics-grid {
        grid-template-columns: 1fr;
    }
}

/* ==================== Animations ==================== */
.fade-in {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.slide-up {
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==================== Scrollbar Styling ==================== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}
/* ==================== FIXES FOR STORAGE CARDS ==================== */
.storage-card {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid var(--border);
    overflow: hidden;
    word-wrap: break-word;
}

.storage-card h4 {
    word-break: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
    font-size: 1rem;
    line-height: 1.4;
}

.storage-info .value {
    word-break: break-word;
    overflow-wrap: break-word;
    text-align: right;
}

/* ==================== MEMORY CHART CONTAINER FIX ==================== */
.memory-container {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
    align-items: center;
}

.memory-container canvas {
    max-width: 250px !important;
    max-height: 250px !important;
    width: 100% !important;
    height: auto !important;
}

/* ==================== ANALYTICS CHART CONTAINERS ==================== */
.chart-container canvas {
    height: 300px !important;
    width: 100% !important;
}

/* ==================== KICK BUTTON STYLING ==================== */
.kick-btn {
    background: var(--danger);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.kick-btn:hover {
    background: #dc2626;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px var(--shadow);
}

.kick-btn i {
    font-size: 1rem;
}

/* ==================== COMPACT VIEW STYLES ==================== */
body.compact-view .server-card {
    padding: 1rem;
}

body.compact-view .server-header h3 {
    font-size: 1rem;
}

body.compact-view .stat-label {
    font-size: 0.75rem;
}

body.compact-view .stat-value {
    font-size: 1.1rem;
}

body.compact-view .servers-grid {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
}

body.compact-view .stat-card {
    padding: 1rem;
}

body.compact-view .stat-icon {
    width: 48px;
    height: 48px;
    font-size: 1.4rem;
}

body.compact-view .stat-content h3 {
    font-size: 1.5rem;
}

body.compact-view .group-header h2 {
    font-size: 1.2rem;
}

/* ==================== ALERT STYLES ==================== */
.alert-section {
    border-left: 4px solid var(--warning);
    background: rgba(245, 158, 11, 0.1);
    padding-left: 1rem;
}

.warning-row {
    background: rgba(245, 158, 11, 0.05);
}

.warning-row:hover {
    background: rgba(245, 158, 11, 0.15);
}

/* ==================== RESPONSIVE STORAGE GRID ==================== */
.storage-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
}

@media (max-width: 768px) {
    .storage-grid {
        grid-template-columns: 1fr;
    }
    
    .memory-container {
        grid-template-columns: 1fr;
        text-align: center;
    }
}

/* ==================== STAT GRID FOR LOAD AVERAGE ==================== */
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.stat-grid .stat-box {
    background: var(--bg-secondary);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}

.stat-grid .stat-label {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    display: block;
}

.stat-grid .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

/* ==================== BETTER TABLE RESPONSIVENESS ==================== */
.stats-table {
    overflow-x: auto;
    display: block;
    max-width: 100%;
}

.stats-table table {
    min-width: 600px;
}

/* ==================== LOADING IMPROVEMENTS ==================== */
.loading-overlay p {
    color: var(--text-primary);
    font-size: 1.1rem;
    margin-top: 1rem;
}

/* ==================== ANALYTICS PAGE IMPROVEMENTS ==================== */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

@media (max-width: 768px) {
    .analytics-grid {
        grid-template-columns: 1fr;
    }
}

/* ==================== SETTINGS PAGE IMPROVEMENTS ==================== */
.settings-container {
    max-width: 900px;
    margin: 0 auto;
}

.setting-group {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    padding: 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
}

.setting-group h3 {
    margin-bottom: 1.5rem;
    color: var(--accent);
    font-size: 1.2rem;
}

.setting-group select,
.setting-group input[type="number"] {
    width: 100%;
    padding: 0.75rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 1rem;
    margin-top: 0.5rem;
}

.threshold-inputs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
}

.threshold-inputs label {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 1rem 0;
    cursor: pointer;
    color: var(--text-primary);
}

.checkbox-label input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--accent);
}

.btn-primary {
    background: var(--accent);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.2s;
    margin-top: 1rem;
}

.btn-primary:hover {
    background: var(--accent-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow);
}

/* ==================== SCROLLBAR IMPROVEMENTS ==================== */
.modal-content {
    scrollbar-width: thin;
    scrollbar-color: var(--border) var(--bg-primary);
}

.modal-content::-webkit-scrollbar {
    width: 10px;
}

.modal-content::-webkit-scrollbar-track {
    background: var(--bg-primary);
    border-radius: 5px;
}

.modal-content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 5px;
}

.modal-content::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* ==================== MOBILE IMPROVEMENTS ==================== */
@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
        z-index: 2000;
    }
    
    .sidebar.show {
        transform: translateX(0);
        box-shadow: 4px 0 20px var(--shadow);
    }
    
    .main-content {
        margin-left: 0;
    }
}

@media (max-width: 768px) {
    .header {
        padding: 0 1rem;
    }
    
    .search-box {
        max-width: 200px;
    }
    
    .theme-switcher {
        flex-wrap: wrap;
    }
    
    .servers-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-section {
        padding: 1rem;
    }
    
    .tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .tab {
        white-space: nowrap;
    }
}

/* ==================== PRINT STYLES ==================== */
@media print {
    .sidebar,
    .header,
    .theme-switcher,
    .sidebar-toggle,
    .kick-btn,
    .close-btn {
        display: none !important;
    }
    
    .main-content {
        margin-left: 0 !important;
    }
    
    .server-card {
        page-break-inside: avoid;
    }
}

/* ==================== ACCESSIBILITY IMPROVEMENTS ==================== */
.server-card:focus,
.nav-item:focus,
.theme-btn:focus,
.tab:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* ==================== PERFORMANCE OPTIMIZATIONS ==================== */
.server-card,
.stat-card,
.modal-content,
.storage-card {
    will-change: transform;
}

/* Use GPU acceleration for animations */
.slide-up,
.fade-in {
    transform: translateZ(0);
    backface-visibility: hidden;
}
.memory-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
    align-items: center;
    margin-top: 1rem;
}

.memory-chart-wrapper {
    width: 300px;
    height: 300px;
    position: relative;
}

.memory-chart-wrapper canvas {
    width: 100% !important;
    height: 100% !important;
    max-width: 300px !important;
    max-height: 300px !important;
}

@media (max-width: 768px) {
    .memory-container {
        grid-template-columns: 1fr;
        text-align: center;
    }
    
    .memory-chart-wrapper {
        margin: 0 auto;
    }
}

/* ==================== ANALYTICS CHARTS VERTICAL LAYOUT ==================== */
.analytics-grid {
    display: flex;
    flex-direction: column;
    gap: 3rem;
    margin-top: 2rem;
}

.chart-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    padding: 2rem;
    border-radius: 16px;
    min-height: 400px;
}

.chart-container h3 {
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.chart-container canvas {
    height: 350px !important;
    width: 100% !important;
}

/* ==================== MODAL CLOSE BUTTON FIX ==================== */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    background: var(--bg-secondary);
    z-index: 10;
}

.close-btn {
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    color: var(--text-primary);
    font-size: 1.5rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    min-width: 40px;
    min-height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
}

.close-btn:hover {
    background: var(--danger);
    color: white;
    transform: rotate(90deg);
    border-color: var(--danger);
}

.close-btn i {
    pointer-events: none;
}

/* ==================== SSH SESSION TAB STYLING ==================== */
#ssh-tab {
    padding: 2rem;
}

#ssh-tab .stats-table {
    background: var(--bg-secondary);
    border-radius: 12px;
    overflow: hidden;
}

#ssh-tab .stats-table thead {
    background: var(--bg-tertiary);
}

#ssh-tab .stats-table th {
    padding: 1rem;
    color: var(--accent);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
}

#ssh-tab .stats-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border);
}

#ssh-tab .stats-table tr:last-child td {
    border-bottom: none;
}

#ssh-tab .stats-table tr:hover {
    background: var(--bg-tertiary);
}

#ssh-tab .kick-btn {
    background: var(--danger);
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
}

#ssh-tab .kick-btn:hover {
    background: #dc2626;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

#ssh-tab .kick-btn i {
    font-size: 1rem;
}

/* Empty state for SSH tab */
#ssh-tab p {
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
    font-size: 1.1rem;
}

/* ==================== ALERT BADGE FIX ==================== */
.nav-item .badge {
    margin-left: auto;
    background: var(--danger);
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
    min-width: 20px;
    text-align: center;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

/* ==================== STAT CARDS IN DASHBOARD ==================== */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px var(--shadow);
}

#alert-servers, #alert-badge {
    animation: pulse 2s infinite;
}

/* ==================== BETTER MODAL SCROLLING ==================== */
.modal-content {
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 20px;
}

.modal-content::-webkit-scrollbar {
    width: 8px;
}

.modal-content::-webkit-scrollbar-track {
    background: var(--bg-primary);
}

.modal-content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}

.modal-content::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* ==================== TAB CONTENT PADDING ==================== */
.tab-content {
    padding: 2rem;
    min-height: 300px;
}

/* ==================== RESPONSIVE IMPROVEMENTS ==================== */
@media (max-width: 768px) {
    .chart-container {
        padding: 1rem;
    }
    
    .chart-container canvas {
        height: 250px !important;
    }
    
    #ssh-tab .stats-table {
        font-size: 0.85rem;
    }
    
    #ssh-tab .kick-btn {
        padding: 0.5rem 0.8rem;
        font-size: 0.85rem;
    }
}

/* ==================== PREVENT LAYOUT SHIFT ==================== */
.chart-container {
    contain: layout;
}

.memory-chart-wrapper {
    contain: layout;
}

.stat-section-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

/* Live CPU Container */
.live-cpu-container {
    position: relative;
    background: var(--bg-secondary);
    border-radius: 12px;
    padding: 1rem;
    min-height: 280px;
}

#live-cpu-chart {
    height: 280px;
}

.current-cpu-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
    z-index: 10;
}

.cpu-value-large {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.cpu-value-large.normal {
    color: #10b981;
}

.cpu-value-large.moderate {
    color: #3b82f6;
}

.cpu-value-large.warning {
    color: #f59e0b;
}

.cpu-value-large.critical {
    color: #ef4444;
    animation: pulse 1.5s infinite;
}

.cpu-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Memory Container in Grid */
.stat-section-grid .memory-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
    align-items: center;
}

/* Responsive */
@media (max-width: 1200px) {
    .stat-section-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .stat-section-grid .memory-container {
        grid-template-columns: 1fr;
        text-align: center;
    }
    
    .memory-chart-wrapper {
        margin: 0 auto;S
    }
    
    .cpu-value-large {
        font-size: 2rem;
    }
}

/* Pulse animation for critical CPU */
@keyframes pulse {
    0%, 100% {
        transform: translate(-50%, -50%) scale(1);
    }
    50% {
        transform: translate(-50%, -50%) scale(1.05);
    }
}


.user-tracking-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 2rem;
    padding: 1rem 0;
}

.user-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.user-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px var(--shadow);
    border-color: var(--accent);
}

.user-card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
}

.user-icon {
    font-size: 3rem;
    color: var(--accent);
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.user-info {
    flex: 1;
}

.user-name {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.user-ip {
    margin: 0;
}

.ip-badge {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-family: 'Courier New', monospace;
}

.ip-badge.named {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
    border-color: var(--accent);
    color: var(--accent);
    font-weight: 600;
}

.user-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.user-stat {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 12px;
}

.user-stat .stat-icon {
    font-size: 2rem;
    color: var(--accent);
}

.user-stat .stat-content {
    flex: 1;
}

.user-stat .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

.user-stat .stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
}

.server-sessions h4 {
    font-size: 1rem;
    color: var(--text-primary);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.session-item {
    background: var(--bg-tertiary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 0.75rem;
    transition: all 0.2s ease;
}

.session-item:hover {
    background: var(--bg-primary);
    border-color: var(--accent);
}

.session-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.server-name {
    font-weight: 600;
    color: var(--accent);
    font-size: 1rem;
}

.session-count {
    padding: 0.2rem 0.6rem;
    background: var(--accent);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.session-details {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.session-time {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.session-time i {
    color: var(--accent);
    width: 16px;
}

/* Empty State */
.empty-state, .error-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-secondary);
}

.empty-state i, .error-state i {
    color: var(--accent);
    opacity: 0.5;
    margin-bottom: 1rem;
}

.empty-state h3, .error-state h3 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.error-state i {
    color: var(--danger);
}

/* Responsive */
@media (max-width: 768px) {
    .user-tracking-grid {
        grid-template-columns: 1fr;
    }
    
    .user-stats {
        grid-template-columns: 1fr;
    }
}

/* Analytics Header */
.analytics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.user-tracking-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
}


@keyframes blink-warning {
    0%, 100% {
        background-color: rgba(245, 158, 11, 0.3);
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }
    50% {
        background-color: rgba(245, 158, 11, 0.6);
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.8);
    }
}

@keyframes blink-critical {
    0%, 100% {
        background-color: rgba(239, 68, 68, 0.3);
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
    }
    50% {
        background-color: rgba(239, 68, 68, 0.6);
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.8);
    }
}

.stat.blink-warning {
    animation: blink-warning 2s ease-in-out infinite;
    border-radius: 8px;
    padding: 0.5rem;
    margin: -0.5rem;
}

.stat.blink-critical {
    animation: blink-critical 1.5s ease-in-out infinite;
    border-radius: 8px;
    padding: 0.5rem;
    margin: -0.5rem;
}

/* Make the stat value also pulse */
.blink-warning .stat-value {
    color: #f59e0b !important;
    font-weight: 700;
}

.blink-critical .stat-value {
    color: #ef4444 !important;
    font-weight: 700;
}

/* Optional: Add pulsing border effect */
.server-card:has(.blink-critical) {
    border-color: rgba(239, 68, 68, 0.5);
    box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
}

.server-card:has(.blink-warning) {
    border-color: rgba(245, 158, 11, 0.5);
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
}


.no-alerts-state {
    text-align: center;
    padding: 4rem 2rem;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
    border-radius: 20px;
    border: 2px solid rgba(16, 185, 129, 0.3);
}

.success-icon {
    font-size: 5rem;
    color: #10b981;
    margin-bottom: 1.5rem;
    animation: successPulse 2s ease-in-out infinite;
}

@keyframes successPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
}

.no-alerts-state h3 {
    color: var(--text-primary);
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
}

.no-alerts-state p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.alert-stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
}

.alert-stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--bg-secondary);
    border-radius: 12px;
    color: var(--text-primary);
    font-weight: 600;
}

.alert-stat-item i {
    color: var(--accent);
    font-size: 1.2rem;
}

/* Alerts Summary Cards */
.alerts-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-card {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border-radius: 16px;
    border: 2px solid var(--border);
    transition: all 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px var(--shadow);
}

.summary-card.critical {
    border-color: rgba(239, 68, 68, 0.5);
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), transparent);
}

.summary-card.warning {
    border-color: rgba(245, 158, 11, 0.5);
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), transparent);
}

.summary-card.info {
    border-color: rgba(59, 130, 246, 0.5);
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), transparent);
}

.summary-card.success {
    border-color: rgba(16, 185, 129, 0.5);
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
}

.summary-icon {
    font-size: 2.5rem;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
}

.summary-card.critical .summary-icon {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.2);
}

.summary-card.warning .summary-icon {
    color: #f59e0b;
    background: rgba(245, 158, 11, 0.2);
}

.summary-card.info .summary-icon {
    color: #3b82f6;
    background: rgba(59, 130, 246, 0.2);
}

.summary-card.success .summary-icon {
    color: #10b981;
    background: rgba(16, 185, 129, 0.2);
}

.summary-content {
    flex: 1;
}

.summary-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

.summary-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
}

/* Alert Categories */
.alerts-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.alert-category {
    background: var(--bg-secondary);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid var(--border);
}

.category-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-size: 1.2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
}

.category-header i {
    color: var(--accent);
}

.alert-items {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

/* Alert Cards */
.alert-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem;
    background: var(--bg-tertiary);
    border-radius: 12px;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.alert-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--accent);
    transition: width 0.3s ease;
}

.alert-card:hover {
    transform: translateX(8px);
    box-shadow: 0 4px 16px var(--shadow);
}

.alert-card:hover::before {
    width: 8px;
}

/* Alert Severity Colors */
.alert-card.critical {
    border-left-color: #ef4444;
}

.alert-card.critical::before {
    background: #ef4444;
}

.alert-card.warning {
    border-left-color: #f59e0b;
}

.alert-card.warning::before {
    background: #f59e0b;
}

.alert-card.moderate {
    border-left-color: #3b82f6;
}

.alert-card.moderate::before {
    background: #3b82f6;
}

/* Alert Type Colors */
.offline-alert {
    background: linear-gradient(90deg, rgba(239, 68, 68, 0.05), transparent);
}

.cpu-alert {
    background: linear-gradient(90deg, rgba(245, 158, 11, 0.05), transparent);
}

.memory-alert {
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.05), transparent);
}

.storage-alert {
    background: linear-gradient(90deg, rgba(16, 185, 129, 0.05), transparent);
}

.alert-indicator {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    animation: alertPulse 2s ease-in-out infinite;
}

.alert-indicator.critical {
    background: #ef4444;
}

.alert-indicator.warning {
    background: #f59e0b;
}

.alert-indicator.moderate {
    background: #3b82f6;
}

@keyframes alertPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.alert-icon-circle {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.offline-alert .alert-icon-circle {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
}

.cpu-alert .alert-icon-circle {
    background: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
}

.memory-alert .alert-icon-circle {
    background: rgba(59, 130, 246, 0.2);
    color: #3b82f6;
}

.storage-alert .alert-icon-circle {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
}

.alert-content {
    flex: 1;
    min-width: 0;
}

.alert-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.alert-server {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.alert-time {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.alert-message {
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
}

.alert-message strong {
    color: var(--text-primary);
}

.alert-progress {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: var(--bg-primary);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
}

.progress-bar.critical .progress-fill {
    background: linear-gradient(90deg, #ef4444, #dc2626);
}

.progress-bar.warning .progress-fill {
    background: linear-gradient(90deg, #f59e0b, #d97706);
}

.progress-bar.moderate .progress-fill {
    background: linear-gradient(90deg, #3b82f6, #2563eb);
}

.progress-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
    min-width: 50px;
    text-align: right;
}

.alert-action {
    font-size: 1.2rem;
    color: var(--text-secondary);
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.alert-card:hover .alert-action {
    color: var(--accent);
    transform: translateX(4px);
}

/* Responsive */
@media (max-width: 768px) {
    .alerts-summary {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .alert-card {
        flex-direction: column;
        text-align: center;
    }
    
    .alert-header {
        flex-direction: column;
        gap: 0.5rem;
    }
}
.analytics-grid {
    display: flex;
    flex-direction: column;
    gap: 3rem;
    margin-top: 2rem;
}

.chart-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    padding: 2rem;
    border-radius: 16px;
    min-height: 500px; /* Increased height to accommodate legend */
    display: flex;
    flex-direction: column;
}

.chart-container h3 {
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
}

.chart-container #cpuChart,
.chart-container #memoryChart {
    flex: 1;
    min-height: 450px; /* Minimum height for chart + legend */
    height: auto !important;
}

/* Force Highcharts legend to be visible */
.highcharts-legend {
    max-height: none !important;
    overflow: visible !important;
}

.highcharts-legend-item {
    cursor: pointer !important;
}

/* Ensure chart doesn't overlap legend */
.highcharts-container {
    overflow: visible !important;
}

/* ==================== STORAGE TAB - COMPLETE STYLES ==================== */

/* Empty State */
.empty-storage-state {
    text-align: center;
    padding: 5rem 2rem;
    color: var(--text-secondary);
}

.empty-storage-state i {
    color: var(--accent);
    opacity: 0.3;
    margin-bottom: 1.5rem;
}

.empty-storage-state h3 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
}

/* Storage Header Section */
.storage-header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
}

.storage-header-section h3 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text-primary);
    font-size: 1.5rem;
    margin: 0;
}

.storage-header-section h3 i {
    color: var(--accent);
}

.storage-stats-summary {
    display: flex;
    gap: 2rem;
}

.storage-summary-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.storage-summary-item i {
    color: var(--accent);
}

/* Storage Cards Grid */
.storage-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 2rem;
}

/* Modern Storage Card */
.storage-card-modern {
    background: var(--bg-secondary);
    border: 2px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.storage-card-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--accent), var(--accent-hover));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.storage-card-modern:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px var(--shadow);
    border-color: var(--accent);
}

.storage-card-modern:hover::before {
    opacity: 1;
}

/* Critical/Warning States */
.storage-card-modern.critical {
    border-color: rgba(239, 68, 68, 0.5);
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), var(--bg-secondary));
}

.storage-card-modern.warning {
    border-color: rgba(245, 158, 11, 0.5);
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), var(--bg-secondary));
}

.storage-card-modern.moderate {
    border-color: rgba(59, 130, 246, 0.5);
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), var(--bg-secondary));
}

/* Card Header */
.storage-card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

.storage-icon-wrapper {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    border-radius: 12px;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.storage-title-section {
    flex: 1;
    min-width: 0;
}

.storage-title-section h4 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 700;
    word-break: break-all;
}

.storage-filesystem {
    display: block;
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
    font-family: 'Courier New', monospace;
}

.storage-status-badge {
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.storage-status-badge.normal {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
}

.storage-status-badge.moderate {
    background: rgba(59, 130, 246, 0.2);
    color: #3b82f6;
}

.storage-status-badge.warning {
    background: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
}

.storage-status-badge.critical {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
}

/* Storage Visualization (Chart) */
.storage-visualization {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 2rem 0;
    height: 160px;
}

.storage-mini-chart {
    position: absolute;
}

.storage-center-info {
    position: relative;
    text-align: center;
    z-index: 1;
}

.storage-percent-large {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
}

.storage-percent-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
    font-weight: 600;
}

/* Storage Details Grid */
.storage-details-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.storage-detail-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: 12px;
    transition: all 0.2s ease;
}

.storage-detail-item:hover {
    background: var(--bg-primary);
    transform: scale(1.02);
}

.storage-detail-item i {
    color: var(--accent);
    font-size: 1.2rem;
}

.storage-detail-content {
    flex: 1;
    min-width: 0;
}

.storage-detail-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.storage-detail-value {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-primary);
    word-break: break-all;
}

/* Modern Progress Bar */
.storage-progress-bar {
    height: 12px;
    background: var(--bg-tertiary);
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 1.5rem;
    position: relative;
}

.storage-progress-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.8s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 0.5rem;
}

.storage-progress-fill::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 2s infinite;
}

.storage-progress-fill.normal {
    background: linear-gradient(90deg, #10b981, #059669);
}

.storage-progress-fill.moderate {
    background: linear-gradient(90deg, #3b82f6, #2563eb);
}

.storage-progress-fill.warning {
    background: linear-gradient(90deg, #f59e0b, #d97706);
}

.storage-progress-fill.critical {
    background: linear-gradient(90deg, #ef4444, #dc2626);
}

.storage-progress-text {
    font-size: 0.7rem;
    font-weight: 700;
    color: white;
    position: relative;
    z-index: 1;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* Analyze Button */
.storage-analyze-btn {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.storage-analyze-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.storage-analyze-btn:hover::before {
    width: 300px;
    height: 300px;
}

.storage-analyze-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(var(--accent-rgb), 0.5);
}

.storage-analyze-btn:active {
    transform: translateY(0);
}

.storage-analyze-btn i {
    font-size: 1.1rem;
    position: relative;
    z-index: 1;
}

.storage-analyze-btn span {
    position: relative;
    z-index: 1;
}

/* Responsive Design */
@media (max-width: 1400px) {
    .storage-cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
}

@media (max-width: 1024px) {
    .storage-cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
   
    .storage-details-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .storage-cards-grid {
        grid-template-columns: 1fr;
    }
   
    .storage-header-section {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
   
    .storage-stats-summary {
        width: 100%;
        justify-content: space-between;
    }
   
    .storage-visualization {
        height: 140px;
    }
   
    .storage-percent-large {
        font-size: 2rem;
    }
}

@media (max-width: 480px) {
    .storage-card-modern {
        padding: 1.5rem;
    }
   
    .storage-details-grid {
        gap: 0.75rem;
    }
   
    .storage-detail-item {
        padding: 0.75rem;
    }
}

/* Animations */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.storage-card-modern {
    animation: slideInUp 0.5s ease backwards;
}

.storage-card-modern:nth-child(1) { animation-delay: 0.1s; }
.storage-card-modern:nth-child(2) { animation-delay: 0.2s; }
.storage-card-modern:nth-child(3) { animation-delay: 0.3s; }
.storage-card-modern:nth-child(4) { animation-delay: 0.4s; }
.storage-card-modern:nth-child(5) { animation-delay: 0.5s; }
.storage-card-modern:nth-child(6) { animation-delay: 0.6s; }



/* ==================== STORAGE ANALYSIS MODAL - COMPLETE REDESIGN ==================== */

/* Modal Content Size */
.modal-content.large {
    max-width: 1400px;
    width: 95%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
}

.modal-header {
    padding: 2rem;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    color: white;
    flex-shrink: 0;
}

.modal-header h2 {
    color: white !important;
    margin: 0;
    font-size: 1.5rem;
}

/* Storage Analysis Container */
.storage-analysis-container {
    padding: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    flex: 1;
}

/* Summary Cards at Top */
.analysis-summary-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    padding: 2rem;
    background: var(--bg-primary);
    border-bottom: 2px solid var(--border);
    flex-shrink: 0;
}

.analysis-summary-card {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border: 2px solid var(--border);
    border-radius: 16px;
    transition: all 0.3s ease;
}

.analysis-summary-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px var(--shadow);
    border-color: var(--accent);
}

.summary-icon {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    border-radius: 12px;
    color: white;
    font-size: 1.75rem;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.summary-info {
    flex: 1;
}

.summary-value {
    font-size: 2.25rem;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1;
    margin-bottom: 0.25rem;
}

.summary-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

/* Tabs Section */
.analysis-tabs-modern {
    display: flex;
    gap: 0;
    padding: 0 2rem;
    background: var(--bg-primary);
    border-bottom: 2px solid var(--border);
    overflow-x: auto;
    flex-shrink: 0;
}

.analysis-tab-btn {
    padding: 1.25rem 2rem;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1rem;
    font-weight: 700;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.analysis-tab-btn:hover {
    color: var(--accent);
    background: rgba(102, 126, 234, 0.05);
}

.analysis-tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
    background: rgba(102, 126, 234, 0.1);
}

.analysis-tab-btn i {
    font-size: 1.1rem;
}

/* Content Area */
.analysis-content-wrapper {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
    background: var(--bg-primary);
}

.analysis-section {
    display: none;
}

.analysis-section.active {
    display: block;
    animation: fadeSlideIn 0.4s ease;
}

@keyframes fadeSlideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.analysis-section h3 {
    margin: 0 0 2rem 0;
    padding: 0 0 1rem 0;
    color: var(--text-primary);
    font-size: 1.4rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border-bottom: 3px solid var(--border);
}

.analysis-section h3 i {
    color: var(--accent);
    font-size: 1.5rem;
}

/* Beautiful Modern Table */
.analysis-table-wrapper {
    overflow: hidden;
    border-radius: 16px;
    border: 2px solid var(--border);
    background: var(--bg-secondary);
    box-shadow: 0 4px 12px var(--shadow);
}

.modern-table {
    width: 100%;
    border-collapse: collapse;
}

.modern-table thead {
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
}

.modern-table th {
    padding: 1.25rem 1.5rem;
    text-align: left;
    font-weight: 700;
    color: white;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.modern-table tbody tr {
    border-bottom: 1px solid var(--border);
    transition: all 0.2s ease;
}

.modern-table tbody tr:hover {
    background: var(--bg-tertiary);
    transform: translateX(4px);
}

.modern-table tbody tr:last-child {
    border-bottom: none;
}

.modern-table td {
    padding: 1.25rem 1.5rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
}

/* Beautiful Badges */
.rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    color: white;
    border-radius: 10px;
    font-weight: 800;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.size-tag {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    color: white;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.9rem;
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.path-code {
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: var(--text-primary);
    background: var(--bg-tertiary);
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    border-left: 3px solid var(--accent);
    display: block;
    word-break: break-all;
    line-height: 1.6;
}

/* File Types Grid - Beautiful Cards */
.file-types-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
}

.file-type-card {
    padding: 1.75rem;
    background: var(--bg-secondary);
    border: 2px solid var(--border);
    border-radius: 16px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px var(--shadow);
}

.file-type-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 12px 30px var(--shadow);
    border-color: var(--accent);
}

.file-type-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.file-type-rank {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--accent), var(--accent-hover));
    color: white;
    border-radius: 12px;
    font-weight: 800;
    font-size: 0.95rem;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.file-type-ext {
    flex: 1;
    font-weight: 800;
    font-size: 1.3rem;
    color: var(--text-primary);
    font-family: 'Courier New', monospace;
}

.file-type-count {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
    background: var(--bg-tertiary);
    padding: 0.35rem 0.75rem;
    border-radius: 8px;
}

.file-type-progress {
    height: 12px;
    background: var(--bg-tertiary);
    border-radius: 6px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

.file-type-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent-hover));
    border-radius: 6px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.file-type-progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: shimmer 2.5s infinite;
}

@keyframes shimmer {
    to {
        left: 200%;
    }
}

/* Loading State */
.analysis-loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6rem 2rem;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 5px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 2rem;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.analysis-loading-state p {
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
}

.loading-subtext {
    font-size: 0.95rem !important;
    color: var(--text-secondary) !important;
    font-weight: 400 !important;
    margin-top: 0.75rem !important;
}

/* Error State */
.analysis-error-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6rem 2rem;
}

.analysis-error-state i {
    color: #ef4444;
    margin-bottom: 1.5rem;
}

.analysis-error-state h3 {
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    font-size: 1.5rem;
    border: none;
    padding: 0;
}

.analysis-error-state p {
    color: var(--text-secondary);
    font-size: 1.05rem;
}

/* Custom Scrollbar */
.analysis-content-wrapper::-webkit-scrollbar {
    width: 10px;
}

.analysis-content-wrapper::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
    border-radius: 5px;
}

.analysis-content-wrapper::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 5px;
}

.analysis-content-wrapper::-webkit-scrollbar-thumb:hover {
    background: var(--accent-hover);
}

/* Responsive Design */
@media (max-width: 1200px) {
    .analysis-summary-cards {
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
    }
    
    .file-types-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
}

@media (max-width: 768px) {
    .modal-content.large {
        width: 100%;
        max-height: 100vh;
        border-radius: 0;
    }
    
    .analysis-summary-cards {
        grid-template-columns: 1fr;
        padding: 1.5rem;
        gap: 1rem;
    }
    
    .analysis-tabs-modern {
        padding: 0 1rem;
        overflow-x: scroll;
    }
    
    .analysis-tab-btn {
        padding: 1rem 1.25rem;
        font-size: 0.9rem;
    }
    
    .analysis-content-wrapper {
        padding: 1.5rem;
    }
    
    .file-types-grid {
        grid-template-columns: 1fr;
    }
    
    .modern-table {
        font-size: 0.85rem;
    }
    
    .modern-table th,
    .modern-table td {
        padding: 0.9rem;
    }
}




this is my monitor.js

// // ==================== Global Variables ====================
// let currentServer = null;
// let refreshInterval = 5000;
// let cpuChartInstance = null;
// let memoryChartInstance = null;
// let isCompactView = false;
// let showOfflineServers = true;

// // ==================== Settings Management ====================
// function loadSettings() {
//   const settings = localStorage.getItem("monitorSettings");
//   if (settings) {
//     const parsed = JSON.parse(settings);
//     refreshInterval = parsed.refreshInterval * 1000 || 5000;
//     isCompactView = parsed.compactView || false;
//     showOfflineServers = parsed.showOffline !== false;

//     document.getElementById("refresh-interval").value =
//       parsed.refreshInterval || 5;
//     document.getElementById("cpu-warning").value = parsed.cpuWarning || 70;
//     document.getElementById("cpu-critical").value = parsed.cpuCritical || 90;
//     document.getElementById("mem-warning").value = parsed.memWarning || 75;
//     document.getElementById("mem-critical").value = parsed.memCritical || 90;
//     document.getElementById("show-offline").checked = showOfflineServers;
//     document.getElementById("compact-view").checked = isCompactView;

//     applyCompactView();
//   }
// }

// function saveSettings() {
//   const settings = {
//     refreshInterval: parseInt(
//       document.getElementById("refresh-interval").value
//     ),
//     cpuWarning: parseInt(document.getElementById("cpu-warning").value),
//     cpuCritical: parseInt(document.getElementById("cpu-critical").value),
//     memWarning: parseInt(document.getElementById("mem-warning").value),
//     memCritical: parseInt(document.getElementById("mem-critical").value),
//     showOffline: document.getElementById("show-offline").checked,
//     compactView: document.getElementById("compact-view").checked,
//   };

//   localStorage.setItem("monitorSettings", JSON.stringify(settings));
//   refreshInterval = settings.refreshInterval * 1000;
//   isCompactView = settings.compactView;
//   showOfflineServers = settings.showOffline;

//   applyCompactView();

//   alert("Settings saved successfully!");

//   // Restart refresh interval
//   clearInterval(window.refreshTimer);
//   window.refreshTimer = setInterval(updateServers, refreshInterval);
// }

// function applyCompactView() {
//   if (isCompactView) {
//     document.body.classList.add("compact-view");
//   } else {
//     document.body.classList.remove("compact-view");
//   }
// }

// // ==================== Helper Functions ====================
// function getCPUStatus(cpuPercent) {
//   if (cpuPercent === null || cpuPercent === undefined) return "";
//   const cpu = parseFloat(cpuPercent);
//   if (isNaN(cpu)) return "";
//   if (cpu >= 90) return "critical";
//   if (cpu >= 70) return "warning";
//   if (cpu >= 50) return "moderate";
//   return "normal";
// }

// function calculateMemoryPercent(used, total) {
//   if (!used || !total || isNaN(used) || isNaN(total) || total === 0) return 0;
//   used = Math.max(0, parseFloat(used));
//   total = Math.max(0, parseFloat(total));
//   const percent = (used / total) * 100;
//   return Math.max(0, Math.min(100, percent));
// }

// function formatBytes(bytes, decimals = 2) {
//   if (bytes === null || bytes === undefined || isNaN(bytes)) return "N/A";
//   bytes = Number(bytes);
//   if (isNaN(bytes) || bytes === 0) return "N/A";

//   const k = 1024;
//   const dm = decimals < 0 ? 0 : decimals;
//   const sizes = ["B", "KB", "MB", "GB", "TB", "PB"];

//   if (bytes < 1) return "0 B";

//   const i = Math.floor(Math.log(bytes) / Math.log(k));
//   const sizeIndex = Math.min(i, sizes.length - 1);

//   return (
//     parseFloat((bytes / Math.pow(k, sizeIndex)).toFixed(dm)) +
//     " " +
//     sizes[sizeIndex]
//   );
// }

// function getStorageBarColor(status) {
//   switch (status) {
//     case "critical":
//       return "#ef4444";
//     case "warning":
//       return "#f59e0b";
//     case "moderate":
//       return "#3b82f6";
//     case "normal":
//       return "#10b981";
//     default:
//       return "#9ca3af";
//   }
// }

// function validateMemoryData(memory) {
//   if (!memory) return null;
//   return {
//     total: Number(memory.total) || 0,
//     used: Number(memory.used) || 0,
//     free: Number(memory.free) || 0,
//     buffers: Number(memory.buffers) || 0,
//     cached: Number(memory.cached) || 0,
//     status: memory.status || "normal",
//   };
// }

// function drawMemoryPieChart(canvas, memoryData) {
//     if (!canvas || !memoryData) return;

//     const existingChart = Chart.getChart(canvas);
//     if (existingChart) existingChart.destroy();

//     const ctx = canvas.getContext('2d');
//     const total = Math.abs(parseFloat(memoryData.total)) || 0;
//     const used = Math.max(0, parseFloat(memoryData.used));
//     const cached = Math.max(0, parseFloat(memoryData.cached));
//     const buffers = Math.max(0, parseFloat(memoryData.buffers));
//     const free = Math.max(0, parseFloat(memoryData.free));

//     const data = [
//         Math.max(0, Math.min(used, total)),
//         Math.max(0, Math.min(cached, total)),
//         Math.max(0, Math.min(buffers, total)),
//         Math.max(0, Math.min(free, total))
//     ];

//     new Chart(ctx, {
//         type: 'doughnut',
//         data: {
//             labels: ['Used', 'Cached', 'Buffers', 'Free'],
//             datasets: [{
//                 data: data,
//                 backgroundColor: ['#ef4444', '#3b82f6', '#f59e0b', '#10b981'],
//                 borderWidth: 0,
//                 borderColor: 'transparent'
//             }]
//         },
//         options: {
//             responsive: true,
//             maintainAspectRatio: true,
//             cutout: '65%',
//             plugins: {
//                 legend: { display: false },
//                 tooltip: {
//                     enabled: true,
//                     callbacks: {
//                         label: (context) => {
//                             const value = context.raw;
//                             const percentage = calculateMemoryPercent(value, total);
//                             return `${context.label}: ${formatBytes(value)} (${percentage.toFixed(1)}%)`;
//                         }
//                     }
//                 }
//             },
//             animation: {
//                 animateRotate: true,
//                 animateScale: false
//             }
//         }
//     });
// }

// // ==================== Navigation ====================
// function initNavigation() {
//   const navItems = document.querySelectorAll(".nav-item");
//   const pages = document.querySelectorAll(".page-content");

//   navItems.forEach((item) => {
//     item.addEventListener("click", (e) => {
//       e.preventDefault();
//       const page = item.getAttribute("data-page");

//       navItems.forEach((nav) => nav.classList.remove("active"));
//       item.classList.add("active");

//       pages.forEach((p) => p.classList.remove("active"));
//       document.getElementById(`${page}-page`).classList.add("active");

//       if (page === "alerts") loadAlerts();
//       if (page === "analytics") loadAnalytics();
//       if (page === "servers") loadAllServers();
//     });
//   });
// }

// // ==================== Sidebar Toggle ====================
// function initSidebarToggle() {
//   const toggle = document.getElementById("sidebarToggle");
//   const sidebar = document.getElementById("sidebar");

//   toggle.addEventListener("click", () => {
//     sidebar.classList.toggle("show");
//   });

//   document.addEventListener("click", (e) => {
//     if (window.innerWidth <= 1024) {
//       if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
//         sidebar.classList.remove("show");
//       }
//     }
//   });
// }

// // ==================== Theme Switcher ====================
// function initThemeSwitcher() {
//   const themeButtons = document.querySelectorAll(".theme-btn");
//   const savedTheme = localStorage.getItem("theme") || "dark";

//   document.body.className = `theme-${savedTheme}`;
//   themeButtons.forEach((btn) => {
//     if (btn.getAttribute("data-theme") === savedTheme) {
//       btn.classList.add("active");
//     }
//   });

//   themeButtons.forEach((btn) => {
//     btn.addEventListener("click", () => {
//       const theme = btn.getAttribute("data-theme");
//       document.body.className = `theme-${theme}`;
//       localStorage.setItem("theme", theme);

//       themeButtons.forEach((b) => b.classList.remove("active"));
//       btn.classList.add("active");
//     });
//   });
// }

// // ==================== Time Display ====================
// function updateTimeDisplay() {
//   fetch("/api/time")
//     .then((response) => response.json())
//     .then((data) => {
//       const timeElement = document.getElementById("current-time");
//       if (timeElement && data.timestamp) {
//         const [dateStr, timeStr] = data.timestamp.split(" ");
//         const [year, month, day] = dateStr.split("-").map(Number);
//         const [hour, minute, second] = timeStr.split(":").map(Number);

//         const utcDate = new Date(
//           Date.UTC(year, month - 1, day, hour, minute, second)
//         );

//         const options = {
//           year: "numeric",
//           month: "2-digit",
//           day: "2-digit",
//           hour: "2-digit",
//           minute: "2-digit",
//           second: "2-digit",
//           hour12: false,
//           timeZone: "Asia/Kolkata",
//         };

//         const istDateTime = utcDate.toLocaleString("en-GB", options);
//         const [d, m, y] = istDateTime.split(",")[0].split("/");
//         const t = istDateTime.split(",")[1].trim();

//         timeElement.textContent = `${y}-${m}-${d} ${t}`;
//       }
//     })
//     .catch((error) => console.error("Error updating time:", error));
// }

// // ==================== Update Servers ====================
// function updateServers() {
//   fetch("/api/status")
//     .then((response) => response.json())
//     .then((data) => {
//       updateStats(data.servers);

//       const groups = {};
//       data.servers.forEach((server) => {
//         if (!showOfflineServers && server.status === "offline") return;
//         const group = server.group || "default";
//         if (!groups[group]) groups[group] = [];
//         groups[group].push(server);
//       });

//       const container = document.getElementById("servers-container");
//       container.innerHTML = "";

//       Object.keys(groups).forEach((groupName) => {
//         const groupSection = createGroupSection(groupName, groups[groupName]);
//         container.appendChild(groupSection);
//       });
//     })
//     .catch((error) => {
//       console.error("Error fetching servers:", error);
//     });
// }

// function updateStats(servers) {
//     const total = servers.length;
//     const online = servers.filter(s => s.status === 'online').length;

//     let totalCPU = 0;
//     let cpuCount = 0;
//     const alertServersSet = new Set();

//     servers.forEach(server => {
//         let hasAlert = false;

//         if (server.status === 'online') {
//             if (server.cpu !== null && server.cpu !== undefined) {
//                 totalCPU += server.cpu;
//                 cpuCount++;

//                 if (server.cpu > 75) {
//                     hasAlert = true;
//                 }
//             }

//             if (server.memory && server.memory.usage_percent > 75) {
//                 hasAlert = true;
//             }

//             if (server.storage) {
//                 for (let storage of server.storage) {
//                     if (storage.mountpoint === '/' && storage.percent > 75) {
//                         hasAlert = true;
//                         break;
//                     }
//                 }
//             }
//         } else {
//             hasAlert = true;
//         }

//         if (hasAlert) {
//             alertServersSet.add(server.name);
//         }
//     });

//     const alertCount = alertServersSet.size;

//     document.getElementById('total-servers').textContent = total;
//     document.getElementById('online-servers').textContent = online;
//     document.getElementById('alert-servers').textContent = alertCount;
//     document.getElementById('avg-cpu').textContent = cpuCount > 0 ? (totalCPU / cpuCount).toFixed(1) + '%' : '0%';
//     document.getElementById('alert-badge').textContent = alertCount;
// }

// function createGroupSection(groupName, servers) {
//   const section = document.createElement("div");
//   section.className = "server-group";

//   const groupIcons = {
//     data: "fa-database",
//     deployment: "fa-rocket",
//     stagging: "fa-flask",
//     gpus: "fa-brain",
//     nginx: "fa-server",
//     development: "fa-code",
//   };

//   section.innerHTML = `
//         <div class="group-header">
//             <i class="fas ${groupIcons[groupName] || "fa-server"}"></i>
//             <h2>${groupName.charAt(0).toUpperCase() + groupName.slice(1)}</h2>
//             <span class="server-count">${servers.length} server${
//     servers.length !== 1 ? "s" : ""
//   }</span>
//         </div>
//         <div class="servers-grid" id="group-${groupName}"></div>
//     `;

//   const grid = section.querySelector(".servers-grid");
//   servers.forEach((server) => {
//     const card = createServerCard(server);
//     grid.appendChild(card);
//   });

//   return section;
// }

// function createServerCard(server) {
//   const card = document.createElement("div");
//   card.className = `server-card ${server.status} slide-up`;
//   card.onclick = () => showServerDetails(server.name);

//   const memory = validateMemoryData(server.memory);
//   const cpuStatus = getCPUStatus(server.cpu);

//   const cpuValue =
//     server.cpu !== null && server.cpu !== undefined
//       ? server.cpu.toFixed(1) + "%"
//       : "N/A";
//   const memValue = memory
//     ? calculateMemoryPercent(memory.used, memory.total).toFixed(1) + "%"
//     : "N/A";

//   let storageValue = "N/A";
//   if (
//     server.storage &&
//     server.storage.length > 0 &&
//     server.storage[0].percent !== null &&
//     server.storage[0].percent !== undefined
//   ) {
//     storageValue = server.storage[0].percent.toFixed(1) + "%";
//   }

//   card.innerHTML = `
//         <div class="server-header">
//             <h3>${server.name}</h3>
//             <span class="status-badge ${server.status}">${server.status}</span>
//         </div>
//         <div class="server-stats">
//             <div class="stat">
//                 <span class="stat-label">CPU</span>
//                 <span class="stat-value ${cpuStatus}">${cpuValue}</span>
//             </div>
//             <div class="stat">
//                 <span class="stat-label">Memory</span>
//                 <span class="stat-value ${
//                   memory ? memory.status : ""
//                 }">${memValue}</span>
//             </div>
//             <div class="stat">
//                 <span class="stat-label">Storage</span>
//                 <span class="stat-value">${storageValue}</span>
//             </div>
//         </div>
//     `;

//   return card;
// }

// // ==================== Server Details Modal ====================
// function showServerDetails(serverName) {
//   showLoading();

//   fetch("/api/status")
//     .then((response) => response.json())
//     .then((data) => {
//       const server = data.servers.find((s) => s.name === serverName);
//       if (server) {
//         currentServer = server;
//         openModal(server);
//       }
//       hideLoading();
//     })
//     .catch((error) => {
//       console.error("Error:", error);
//       hideLoading();
//     });
// }

// function openModal(server) {
//   const modal = document.getElementById("server-modal");
//   document.getElementById("modal-server-name").textContent = server.name;

//   modal.classList.add("show");
//   setupTabs();
//   renderOverviewTab(server);
// }

// function closeModal() {
//     document.getElementById('server-modal').classList.remove('show');
//     stopLiveCPUUpdates(); // Stop live CPU updates when modal closes
//     if (liveCPUChart) {
//         liveCPUChart.destroy();
//         liveCPUChart = null;
//     }
// }

// function setupTabs() {
//     const tabs = document.querySelectorAll('.tabs .tab');
//     const contents = document.querySelectorAll('.tab-content');

//     tabs.forEach(tab => {
//         tab.addEventListener('click', () => {
//             const tabName = tab.getAttribute('data-tab');

//             tabs.forEach(t => t.classList.remove('active'));
//             tab.classList.add('active');

//             contents.forEach(c => c.classList.remove('active'));
//             document.getElementById(`${tabName}-tab`).classList.add('active');

//             // Stop live CPU updates when switching away from overview
//             if (tabName !== 'overview') {
//                 stopLiveCPUUpdates();
//             }

//             switch(tabName) {
//                 case 'overview':
//                     renderOverviewTab(currentServer);
//                     break;
//                 case 'storage':
//                     renderStorageTab(currentServer);
//                     break;
//                 case 'processes':
//                     renderProcessesTab(currentServer);
//                     break;
//                 case 'services':
//                     renderServicesTab(currentServer);
//                     break;
//                 case 'ssh':
//                     renderSSHTab(currentServer);
//                     break;
//             }
//         });
//     });
// }

// function renderOverviewTab(server) {
//     const memory = validateMemoryData(server.memory);
//     const cpuStatus = getCPUStatus(server.cpu);
//     const cpuValue = (server.cpu !== null && server.cpu !== undefined) ? server.cpu.toFixed(1) + '%' : 'N/A';

//     let html = `
//         <div class="overview-stats">
//             <!-- CPU and Memory Side by Side -->
//             <div class="stat-section-grid">
//                 <!-- CPU Live Chart -->
//                 <div class="stat-section">
//                     <h3><i class="fas fa-microchip"></i> Live CPU Usage</h3>
//                     <div class="live-cpu-container">
//                         <div id="live-cpu-chart"></div>
//                         <div class="current-cpu-display">
//                             <div class="cpu-value-large ${cpuStatus}">${cpuValue}</div>
//                             <div class="cpu-label">Current Usage</div>
//                         </div>
//                     </div>
//                 </div>

//                 <!-- Memory Pie Chart -->
//                 <div class="stat-section">
//                     <h3><i class="fas fa-memory"></i> Memory Usage</h3>
//                     ${memory ? `
//                         <div class="memory-container">
//                             <div class="memory-chart-wrapper">
//                                 <canvas id="memory-chart"></canvas>
//                             </div>
//                             <div class="memory-stats">
//                                 <div class="memory-stat">
//                                     <span class="memory-label" style="background: #ef4444;"></span>
//                                     <span>Used: ${formatBytes(memory.used)}</span>
//                                 </div>
//                                 <div class="memory-stat">
//                                     <span class="memory-label" style="background: #3b82f6;"></span>
//                                     <span>Cached: ${formatBytes(memory.cached)}</span>
//                                 </div>
//                                 <div class="memory-stat">
//                                     <span class="memory-label" style="background: #f59e0b;"></span>
//                                     <span>Buffers: ${formatBytes(memory.buffers)}</span>
//                                 </div>
//                                 <div class="memory-stat">
//                                     <span class="memory-label" style="background: #10b981;"></span>
//                                     <span>Free: ${formatBytes(memory.free)}</span>
//                                 </div>
//                                 <div class="memory-total">
//                                     Total: ${formatBytes(memory.total)}
//                                 </div>
//                             </div>
//                         </div>
//                     ` : '<p>Memory data not available</p>'}
//                 </div>
//             </div>

//             ${server.load_average ? `
//                 <div class="stat-section">
//                     <h3><i class="fas fa-tachometer-alt"></i> System Load</h3>
//                     <div class="stat-grid">
//                         <div class="stat-box">
//                             <div class="stat-label">1 min</div>
//                             <div class="stat-value">${server.load_average.load_1min}</div>
//                         </div>
//                         <div class="stat-box">
//                             <div class="stat-label">5 min</div>
//                             <div class="stat-value">${server.load_average.load_5min}</div>
//                         </div>
//                         <div class="stat-box">
//                             <div class="stat-label">15 min</div>
//                             <div class="stat-value">${server.load_average.load_15min}</div>
//                         </div>
//                         <div class="stat-box">
//                             <div class="stat-label">Processes</div>
//                             <div class="stat-value">${server.load_average.running_processes}/${server.load_average.total_processes}</div>
//                         </div>
//                     </div>
//                 </div>
//             ` : ''}

//             ${server.uptime ? `
//                 <div class="stat-section">
//                     <h3><i class="fas fa-clock"></i> Uptime</h3>
//                     <div class="stat-box">
//                         <div class="stat-label">Running Since</div>
//                         <div class="stat-value">${server.uptime.uptime_human}</div>
//                         <div class="stat-label" style="margin-top: 0.5rem;">Boot Time: ${server.uptime.boot_time}</div>
//                     </div>
//                 </div>
//             ` : ''}

//             ${server.network_stats && server.network_stats.length > 0 ? `
//                 <div class="stat-section">
//                     <h3><i class="fas fa-network-wired"></i> Network Interfaces</h3>
//                     <table class="stats-table">
//                         <thead>
//                             <tr>
//                                 <th>Interface</th>
//                                 <th>RX (MB)</th>
//                                 <th>TX (MB)</th>
//                                 <th>Packets</th>
//                             </tr>
//                         </thead>
//                         <tbody>
//                             ${server.network_stats.map(net => {
//                                 const rxMB = (net.rx_bytes / (1024 * 1024)).toFixed(2);
//                                 const txMB = (net.tx_bytes / (1024 * 1024)).toFixed(2);
//                                 return `
//                                     <tr>
//                                         <td><strong>${net.interface}</strong></td>
//                                         <td>${rxMB} MB</td>
//                                         <td>${txMB} MB</td>
//                                         <td>${net.rx_packets} ${net.tx_packets}</td>
//                                     </tr>
//                                 `;
//                             }).join('')}
//                         </tbody>
//                     </table>
//                 </div>
//             ` : ''}

//             ${server.top_cpu_processes && server.top_cpu_processes.length > 0 ? `
//                 <div class="stat-section">
//                     <h3><i class="fas fa-microchip"></i> Top CPU Processes</h3>
//                     <table class="stats-table">
//                         <thead>
//                             <tr>
//                                 <th>PID</th>
//                                 <th>User</th>
//                                 <th>CPU %</th>
//                                 <th>MEM %</th>
//                                 <th>Command</th>
//                             </tr>
//                         </thead>
//                         <tbody>
//                             ${server.top_cpu_processes.map(proc => `
//                                 <tr>
//                                     <td>${proc.pid}</td>
//                                     <td>${proc.user}</td>
//                                     <td><strong>${proc.cpu}%</strong></td>
//                                     <td>${proc.mem}%</td>
//                                     <td><code>${proc.command}</code></td>
//                                 </tr>
//                             `).join('')}
//                         </tbody>
//                     </table>
//                 </div>
//             ` : ''}

//             ${server.top_mem_processes && server.top_mem_processes.length > 0 ? `
//                 <div class="stat-section">
//                     <h3><i class="fas fa-memory"></i> Top Memory Processes</h3>
//                     <table class="stats-table">
//                         <thead>
//                             <tr>
//                                 <th>PID</th>
//                                 <th>User</th>
//                                 <th>CPU %</th>
//                                 <th>MEM %</th>
//                                 <th>Command</th>
//                             </tr>
//                         </thead>
//                         <tbody>
//                             ${server.top_mem_processes.map(proc => `
//                                 <tr>
//                                     <td>${proc.pid}</td>
//                                     <td>${proc.user}</td>
//                                     <td>${proc.cpu}%</td>
//                                     <td><strong>${proc.mem}%</strong></td>
//                                     <td><code>${proc.command}</code></td>
//                                 </tr>
//                             `).join('')}
//                         </tbody>
//                     </table>
//                 </div>
//             ` : ''}
//         </div>
//     `;

//     document.getElementById('overview-tab').innerHTML = html;

//     // Initialize Memory Chart
//     if (memory) {
//         setTimeout(() => {
//             const canvas = document.getElementById('memory-chart');
//             if (canvas) {
//                 drawMemoryPieChart(canvas, memory);
//             }
//         }, 100);
//     }

//     // Initialize Live CPU Chart
//     if (server.cpu !== null && server.cpu !== undefined) {
//         initLiveCPUChart(server.name, server.cpu);
//     }
// }

// let liveCPUChart = null;
// let liveCPUData = [];
// let liveCPUInterval = null;

// function initLiveCPUChart(serverName, initialCPU) {
//     // Clear previous data
//     liveCPUData = [];

//     // Initialize with current CPU value
//     const now = new Date().getTime();
//     liveCPUData.push([now, initialCPU]);

//     // Create Highcharts chart
//     liveCPUChart = Highcharts.chart('live-cpu-chart', {
//         chart: {
//             type: 'areaspline',
//             backgroundColor: 'transparent',
//             height: 280,
//             animation: Highcharts.svg
//         },
//         title: {
//             text: null
//         },
//         xAxis: {
//             type: 'datetime',
//             tickPixelInterval: 150,
//             gridLineColor: 'rgba(255, 255, 255, 0.05)',
//             labels: {
//                 style: {
//                     color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
//                 }
//             }
//         },
//         yAxis: {
//             title: {
//                 text: 'CPU Usage (%)',
//                 style: {
//                     color: getComputedStyle(document.body).getPropertyValue('--text-primary')
//                 }
//             },
//             min: 0,
//             max: 100,
//             gridLineColor: 'rgba(255, 255, 255, 0.05)',
//             labels: {
//                 style: {
//                     color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
//                 }
//             },
//             plotLines: [{
//                 value: 70,
//                 color: '#f59e0b',
//                 dashStyle: 'shortdash',
//                 width: 2,
//                 label: {
//                     text: 'Warning',
//                     style: {
//                         color: '#f59e0b'
//                     }
//                 }
//             }, {
//                 value: 90,
//                 color: '#ef4444',
//                 dashStyle: 'shortdash',
//                 width: 2,
//                 label: {
//                     text: 'Critical',
//                     style: {
//                         color: '#ef4444'
//                     }
//                 }
//             }]
//         },
//         legend: {
//             enabled: false
//         },
//         credits: {
//             enabled: false
//         },
//         exporting: {
//             enabled: false
//         },
//         tooltip: {
//             formatter: function() {
//                 return '<b>' + Highcharts.dateFormat('%H:%M:%S', this.x) + '</b><br/>' +
//                        'CPU: ' + this.y.toFixed(1) + '%';
//             },
//             backgroundColor: 'rgba(0, 0, 0, 0.8)',
//             style: {
//                 color: '#fff'
//             }
//         },
//         series: [{
//             name: 'CPU Usage',
//             data: liveCPUData,
//             color: {
//                 linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
//                 stops: [
//                     [0, '#667eea'],
//                     [1, 'rgba(102, 126, 234, 0.1)']
//                 ]
//             },
//             fillOpacity: 0.3,
//             lineWidth: 2,
//             marker: {
//                 enabled: false,
//                 states: {
//                     hover: {
//                         enabled: true,
//                         radius: 5
//                     }
//                 }
//             }
//         }]
//     });

//     // Start real-time updates
//     startLiveCPUUpdates(serverName);
// }

// function startLiveCPUUpdates(serverName) {
//     // Clear any existing interval
//     if (liveCPUInterval) {
//         clearInterval(liveCPUInterval);
//     }

//     // Update every 2 seconds
//     liveCPUInterval = setInterval(() => {
//         fetch('/api/status')
//             .then(response => response.json())
//             .then(data => {
//                 const server = data.servers.find(s => s.name === serverName);
//                 if (server && server.cpu !== null && server.cpu !== undefined) {
//                     updateLiveCPUChart(server.cpu);

//                     // Update the display value
//                     const displayElement = document.querySelector('.cpu-value-large');
//                     if (displayElement) {
//                         displayElement.textContent = server.cpu.toFixed(1) + '%';
//                         displayElement.className = 'cpu-value-large ' + getCPUStatus(server.cpu);
//                     }
//                 }
//             })
//             .catch(error => console.error('Error updating live CPU:', error));
//     }, 2000);
// }

// function updateLiveCPUChart(cpuValue) {
//     if (!liveCPUChart) return;

//     const now = new Date().getTime();
//     const series = liveCPUChart.series[0];

//     // Add new point
//     series.addPoint([now, cpuValue], true, liveCPUData.length > 30);

//     // Keep only last 30 points (1 minute of data)
//     if (liveCPUData.length > 30) {
//         liveCPUData.shift();
//     }
//     liveCPUData.push([now, cpuValue]);
// }

// function stopLiveCPUUpdates() {
//     if (liveCPUInterval) {
//         clearInterval(liveCPUInterval);
//         liveCPUInterval = null;
//     }
// }

// function renderStorageTab(server) {
//   if (!server.storage || server.storage.length === 0) {
//     document.getElementById("storage-tab").innerHTML =
//       "<p>No storage data available</p>";
//     return;
//   }

//   const html = `
//         <div class="storage-grid">
//             ${server.storage
//               .map(
//                 (drive) => `
//                 <div class="storage-card">
//                     <div class="storage-header">
//                         <h4 style="word-break: break-all;">${
//                           drive.mountpoint
//                         }</h4>
//                         <span class="status-badge ${drive.status}">${
//                   drive.status
//                 }</span>
//                     </div>
//                     <div class="storage-info">
//                         <div class="storage-stat">
//                             <span class="label">Filesystem:</span>
//                             <span class="value" style="word-break: break-all; font-size: 0.85rem;">${
//                               drive.filesystem
//                             }</span>
//                         </div>
//                         <div class="storage-stat">
//                             <span class="label">Total:</span>
//                             <span class="value">${formatBytes(
//                               drive.size
//                             )}</span>
//                         </div>
//                         <div class="storage-stat">
//                             <span class="label">Used:</span>
//                             <span class="value">${formatBytes(
//                               drive.used
//                             )}</span>
//                         </div>
//                         <div class="storage-stat">
//                             <span class="label">Free:</span>
//                             <span class="value">${formatBytes(
//                               drive.available
//                             )}</span>
//                         </div>
//                     </div>
//                     <div class="storage-bar">
//                         <div class="storage-bar-fill" style="width: ${
//                           drive.percent
//                         }%; background: ${getStorageBarColor(
//                   drive.status
//                 )}"></div>
//                     </div>
//                     <div class="storage-percent">${drive.percent.toFixed(
//                       1
//                     )}%</div>
//                 </div>
//             `
//               )
//               .join("")}
//         </div>
//     `;

//   document.getElementById("storage-tab").innerHTML = html;
// }

// function renderProcessesTab(server) {
//   document.getElementById("processes-tab").innerHTML =
//     "<p>Loading processes...</p>";

//   fetch("/api/user_services", {
//     method: "POST",
//     headers: { "Content-Type": "application/json" },
//     body: JSON.stringify({ server: server.name }),
//   })
//     .then((response) => response.json())
//     .then((data) => {
//       if (!data.processes || data.processes.length === 0) {
//         document.getElementById("processes-tab").innerHTML =
//           "<p>No processes found</p>";
//         return;
//       }

//       const html = `
//             <table class="stats-table">
//                 <thead>
//                     <tr>
//                         <th>User</th>
//                         <th>IP</th>
//                         <th>Login</th>
//                         <th>TTY</th>
//                         <th>PID</th>
//                         <th>Command</th>
//                     </tr>
//                 </thead>
//                 <tbody>
//                     ${data.processes
//                       .map(
//                         (proc) => `
//                         <tr>
//                             <td>${proc.user}</td>
//                             <td>${proc.ip}</td>
//                             <td>${proc.login_date} ${proc.login_time}</td>
//                             <td>${proc.tty}</td>
//                             <td>${proc.pid}</td>
//                             <td><code>${proc.cmd}</code></td>
//                         </tr>
//                     `
//                       )
//                       .join("")}
//                 </tbody>
//             </table>
//         `;

//       document.getElementById("processes-tab").innerHTML = html;
//     })
//     .catch((error) => {
//       document.getElementById("processes-tab").innerHTML =
//         "<p>Error loading processes</p>";
//       console.error("Error:", error);
//     });
// }

// function renderServicesTab(server) {
//   const services = server.services || [];
//   const failedServices = server.failed_services || [];

//   if (services.length === 0 && failedServices.length === 0) {
//     document.getElementById("services-tab").innerHTML =
//       "<p>No services data available</p>";
//     return;
//   }

//   let html = "";

//   // Show failed services first
//   if (failedServices.length > 0) {
//     html += `
//             <div class="stat-section alert-section">
//                 <h3><i class="fas fa-exclamation-triangle"></i> Failed Services (${
//                   failedServices.length
//                 })</h3>
//                 <table class="stats-table">
//                     <thead>
//                         <tr>
//                             <th>Service</th>
//                             <th>Status</th>
//                             <th>Reason</th>
//                         </tr>
//                     </thead>
//                     <tbody>
//                         ${failedServices
//                           .map(
//                             (service) => `
//                             <tr class="warning-row">
//                                 <td><strong>${service.name}</strong></td>
//                                 <td><span class="status-badge offline">Failed</span></td>
//                                 <td>${service.reason}</td>
//                             </tr>
//                         `
//                           )
//                           .join("")}
//                     </tbody>
//                 </table>
//             </div>
//         `;
//   }

//   // Show running services
//   if (services.length > 0) {
//     html += `
//             <div class="stat-section">
//                 <h3><i class="fas fa-check-circle"></i> Running Services (${
//                   services.length
//                 })</h3>
//                 <table class="stats-table">
//                     <thead>
//                         <tr>
//                             <th>Service</th>
//                             <th>Description</th>
//                         </tr>
//                     </thead>
//                     <tbody>
//                         ${services
//                           .map(
//                             (service) => `
//                             <tr>
//                                 <td><strong>${service.name}</strong></td>
//                                 <td>${service.description || "N/A"}</td>
//                             </tr>
//                         `
//                           )
//                           .join("")}
//                     </tbody>
//                 </table>
//             </div>
//         `;
//   }

//   document.getElementById("services-tab").innerHTML = html;
// }

// function renderSSHTab(server) {
//   if (!server.ssh_connections || server.ssh_connections.length === 0) {
//     document.getElementById("ssh-tab").innerHTML =
//       "<p>No active SSH connections</p>";
//     return;
//   }

//   const html = `
//         <table class="stats-table">
//             <thead>
//                 <tr>
//                     <th>User</th>
//                     <th>IP Address</th>
//                     <th>Action</th>
//                 </tr>
//             </thead>
//             <tbody>
//                 ${server.ssh_connections
//                   .map(
//                     (conn) => `
//                     <tr>
//                         <td><strong>${conn.user}</strong></td>
//                         <td>${conn.ip}</td>
//                         <td>
//                             <button class="kick-btn" onclick="kickSSHUser('${server.name}', '${conn.ip}')">
//                                 <i class="fas fa-user-times"></i> Kick
//                             </button>
//                         </td>
//                     </tr>
//                 `
//                   )
//                   .join("")}
//             </tbody>
//         </table>
//     `;

//   document.getElementById("ssh-tab").innerHTML = html;
// }

// function kickSSHUser(serverName, ip) {
//   if (!confirm(`Are you sure you want to kick user from ${ip}?`)) return;

//   showLoading();
//   fetch("/api/kick_ssh", {
//     method: "POST",
//     headers: { "Content-Type": "application/json" },
//     body: JSON.stringify({ server: serverName, ip: ip }),
//   })
//     .then((response) => response.json())
//     .then((data) => {
//       hideLoading();
//       if (data.success) {
//         alert("User kicked successfully");
//         showServerDetails(serverName);
//       } else {
//         alert("Failed to kick user: " + (data.error || "Unknown error"));
//       }
//     })
//     .catch((error) => {
//       hideLoading();
//       console.error("Error:", error);
//       alert("Error kicking user");
//     });
// }

// // ==================== Alerts ====================
// function loadAlerts() {
//   fetch("/api/alerts")
//     .then((response) => response.json())
//     .then((data) => {
//       const container = document.getElementById("alerts-container");

//       if (data.alerts.length === 0) {
//         container.innerHTML =
//           '<p style="text-align: center; padding: 3rem; color: var(--text-secondary);"> No alerts at this time - all systems operational!</p>';
//         return;
//       }

//       container.innerHTML = data.alerts
//         .map(
//           (alert) => `
//                 <div class="alert-item">
//                     <div class="alert-icon">
//                         <i class="fas fa-exclamation-triangle"></i>
//                     </div>
//                     <div class="alert-content">
//                         <h4>${alert.server}</h4>
//                         <p><strong>${alert.type}:</strong> ${alert.message}</p>
//                     </div>
//                 </div>
//             `
//         )
//         .join("");
//     });
// }

// // ==================== Analytics ====================
// function loadAnalytics() {
//     fetch('/api/analytics')
//         .then(response => response.json())
//         .then(data => {
//             if (!data || data.length === 0) {
//                 document.querySelector('.analytics-grid').innerHTML = `
//                     <div class="chart-container" style="grid-column: 1 / -1;">
//                         <p style="text-align: center; padding: 3rem; color: var(--text-secondary);">
//                              Collecting data... Check back in a few minutes
//                         </p>
//                     </div>
//                 `;
//                 return;
//             }

//             // Prepare data
//             const labels = data.slice(-20).map(d => {
//                 const date = new Date(d.timestamp);
//                 return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
//             });

//             const serverNames = [...new Set(data.flatMap(d => d.servers.map(s => s.name)))];
//             const colors = ['#ef4444', '#3b82f6', '#f59e0b', '#10b981', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

//             // CPU Datasets
//             const cpuDatasets = serverNames.map((name, index) => ({
//                 label: name,
//                 data: data.slice(-20).map(d => {
//                     const server = d.servers.find(s => s.name === name);
//                     return server && server.cpu !== null ? server.cpu : null;
//                 }),
//                 borderColor: colors[index % colors.length],
//                 backgroundColor: colors[index % colors.length] + '20',
//                 borderWidth: 2,
//                 tension: 0.4,
//                 pointRadius: 4,
//                 pointHoverRadius: 6,
//                 hidden: false
//             }));

//             // Memory Datasets
//             const memoryDatasets = serverNames.map((name, index) => ({
//                 label: name,
//                 data: data.slice(-20).map(d => {
//                     const server = d.servers.find(s => s.name === name);
//                     return server && server.memory_percent !== null ? server.memory_percent : null;
//                 }),
//                 borderColor: colors[index % colors.length],
//                 backgroundColor: colors[index % colors.length] + '20',
//                 borderWidth: 2,
//                 tension: 0.4,
//                 pointRadius: 4,
//                 pointHoverRadius: 6,
//                 hidden: false
//             }));

//             // Destroy existing charts
//             if (cpuChartInstance) cpuChartInstance.destroy();
//             if (memoryChartInstance) memoryChartInstance.destroy();

//             // CPU Chart
//             const cpuCtx = document.getElementById('cpuChart').getContext('2d');
//             cpuChartInstance = new Chart(cpuCtx, {
//                 type: 'line',
//                 data: {
//                     labels: labels,
//                     datasets: cpuDatasets
//                 },
//                 options: {
//                     responsive: true,
//                     maintainAspectRatio: false,
//                     interaction: {
//                         mode: 'index',
//                         intersect: false
//                     },
//                     plugins: {
//                         legend: {
//                             display: true,
//                             position: 'bottom',
//                             onClick: (e, legendItem, legend) => {
//                                 const index = legendItem.datasetIndex;
//                                 const ci = legend.chart;
//                                 const meta = ci.getDatasetMeta(index);
//                                 meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
//                                 ci.update();
//                             },
//                             labels: {
//                                 padding: 15,
//                                 usePointStyle: true,
//                                 font: { size: 11 }
//                             }
//                         },
//                         tooltip: {
//                             backgroundColor: 'rgba(0, 0, 0, 0.8)',
//                             titleColor: '#fff',
//                             bodyColor: '#fff',
//                             borderColor: 'rgba(255, 255, 255, 0.2)',
//                             borderWidth: 1,
//                             padding: 12,
//                             displayColors: true,
//                             callbacks: {
//                                 label: (context) => {
//                                     return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
//                                 }
//                             }
//                         }
//                     },
//                     scales: {
//                         y: {
//                             beginAtZero: true,
//                             max: 100,
//                             ticks: {
//                                 callback: value => value + '%',
//                                 color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
//                             },
//                             grid: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--border')
//                             }
//                         },
//                         x: {
//                             ticks: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
//                                 maxRotation: 45,
//                                 minRotation: 45
//                             },
//                             grid: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--border')
//                             }
//                         }
//                     }
//                 }
//             });

//             // Memory Chart
//             const memCtx = document.getElementById('memoryChart').getContext('2d');
//             memoryChartInstance = new Chart(memCtx, {
//                 type: 'line',
//                 data: {
//                     labels: labels,
//                     datasets: memoryDatasets
//                 },
//                 options: {
//                     responsive: true,
//                     maintainAspectRatio: false,
//                     interaction: {
//                         mode: 'index',
//                         intersect: false
//                     },
//                     plugins: {
//                         legend: {
//                             display: true,
//                             position: 'bottom',
//                             onClick: (e, legendItem, legend) => {
//                                 const index = legendItem.datasetIndex;
//                                 const ci = legend.chart;
//                                 const meta = ci.getDatasetMeta(index);
//                                 meta.hidden = meta.hidden === null ? !ci.data.datasets[index].hidden : null;
//                                 ci.update();
//                             },
//                             labels: {
//                                 padding: 15,
//                                 usePointStyle: true,
//                                 font: { size: 11 }
//                             }
//                         },
//                         tooltip: {
//                             backgroundColor: 'rgba(0, 0, 0, 0.8)',
//                             titleColor: '#fff',
//                             bodyColor: '#fff',
//                             borderColor: 'rgba(255, 255, 255, 0.2)',
//                             borderWidth: 1,
//                             padding: 12,
//                             displayColors: true,
//                             callbacks: {
//                                 label: (context) => {
//                                     return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
//                                 }
//                             }
//                         }
//                     },
//                     scales: {
//                         y: {
//                             beginAtZero: true,
//                             max: 100,
//                             ticks: {
//                                 callback: value => value + '%',
//                                 color: getComputedStyle(document.body).getPropertyValue('--text-secondary')
//                             },
//                             grid: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--border')
//                             }
//                         },
//                         x: {
//                             ticks: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--text-secondary'),
//                                 maxRotation: 45,
//                                 minRotation: 45
//                             },
//                             grid: {
//                                 color: getComputedStyle(document.body).getPropertyValue('--border')
//                             }
//                         }
//                     }
//                 }
//             });
//         })
//         .catch(error => {
//             console.error('Error loading analytics:', error);
//         });
// }

// // ==================== All Servers ====================
// function loadAllServers() {
//   fetch("/api/status")
//     .then((response) => response.json())
//     .then((data) => {
//       const container = document.getElementById("all-servers-list");
//       container.innerHTML = `
//                 <div class="servers-grid">
//                     ${data.servers
//                       .map((server) => {
//                         const memory = validateMemoryData(server.memory);
//                         const cpuStatus = getCPUStatus(server.cpu);
//                         const cpuValue =
//                           server.cpu !== null && server.cpu !== undefined
//                             ? server.cpu.toFixed(1) + "%"
//                             : "N/A";
//                         const memValue = memory
//                           ? calculateMemoryPercent(
//                               memory.used,
//                               memory.total
//                             ).toFixed(1) + "%"
//                           : "N/A";
//                         let storageValue = "N/A";
//                         if (
//                           server.storage &&
//                           server.storage.length > 0 &&
//                           server.storage[0].percent !== null &&
//                           server.storage[0].percent !== undefined
//                         ) {
//                           storageValue =
//                             server.storage[0].percent.toFixed(1) + "%";
//                         }

//                         return `
//                             <div class="server-card ${
//                               server.status
//                             }" onclick="showServerDetails('${server.name}')">
//                                 <div class="server-header">
//                                     <h3>${server.name}</h3>
//                                     <span class="status-badge ${
//                                       server.status
//                                     }">${server.status}</span>
//                                 </div>
//                                 <div class="server-stats">
//                                     <div class="stat">
//                                         <span class="stat-label">CPU</span>
//                                         <span class="stat-value ${cpuStatus}">${cpuValue}</span>
//                                     </div>
//                                     <div class="stat">
//                                         <span class="stat-label">Memory</span>
//                                         <span class="stat-value ${
//                                           memory ? memory.status : ""
//                                         }">${memValue}</span>
//                                     </div>
//                                     <div class="stat">
//                                         <span class="stat-label">Storage</span>
//                                         <span class="stat-value">${storageValue}</span>
//                                     </div>
//                                 </div>
//                             </div>
//                         `;
//                       })
//                       .join("")}
//                 </div>
//             `;
//     });
// }

// // ==================== Loading ====================
// function showLoading() {
//   document.getElementById("loading").classList.add("show");
// }

// function hideLoading() {
//   document.getElementById("loading").classList.remove("show");
// }

// // ==================== Search ====================
// function initSearch() {
//   const searchInput = document.getElementById("serverSearch");
//   searchInput.addEventListener("input", (e) => {
//     const query = e.target.value.toLowerCase();
//     const cards = document.querySelectorAll(".server-card");

//     cards.forEach((card) => {
//       const name = card.querySelector("h3").textContent.toLowerCase();
//       if (name.includes(query)) {
//         card.style.display = "block";
//       } else {
//         card.style.display = "none";
//       }
//     });
//   });
// }

// function loadAnalyticsByDateRange(){
//     const from = document.getElementById('date-from').value;
//     const to = document.getElementById('date-to').value;

//     if (! from || !to){
//         alert("Please select both dates")
//         return;
//     }

//     fetch(`/api/analytics_range?start=${from}&end=${to}`)
//     .then(res=>res.json())
//     .then(drawAnalyticsCharts)
//     .cache(e=>alert("Error loading analytics for the range"))

// }
// function drawAnalyticsCharts(data) {
//     if (!data || data.length === 0) {
//         document.getElementById('cpuChart').innerHTML = '<p>No analytics data available</p>';
//         document.getElementById('memoryChart').innerHTML = '<p>No analytics data available</p>';
//         return;
//     }

//     // Prepare data
//     const labels = data.map(entry => {
//         const d = new Date(entry.timestamp);
//         return d.toLocaleString();
//     });

//     // Extract unique server names
//     const serverNames = [...new Set(data.flatMap(entry => entry.servers.map(s => s.name)))];

//     // Prepare CPU datasets
//     const cpuDatasets = serverNames.map((serverName, idx) => ({
//         name: serverName,
//         data: data.map(entry => {
//             const srv = entry.servers.find(s => s.name === serverName);
//             return srv ? srv.cpu : null;
//         }),
//         color: Highcharts.getOptions().colors[idx % Highcharts.getOptions().colors.length],
//         visible: true
//     }));

//     // Prepare Memory datasets
//     const memDatasets = serverNames.map((serverName, idx) => ({
//         name: serverName,
//         data: data.map(entry => {
//             const srv = entry.servers.find(s => s.name === serverName);
//             return srv ? srv.memory_percent : null;
//         }),
//         color: Highcharts.getOptions().colors[idx % Highcharts.getOptions().colors.length],
//         visible: true
//     }));

//     // CPU Chart
//     Highcharts.chart('cpuChart', {
//         chart: {
//             type: 'line',
//             zoomType: 'x'
//         },
//         title: { text: 'CPU Usage Trend' },
//         xAxis: {
//             categories: labels,
//             labels: { rotation: -45 }
//         },
//         yAxis: {
//             min: 0,
//             max: 100,
//             title: { text: 'CPU Usage (%)' },
//             plotLines: [
//                 { value: 70, color: '#f59e0b', width: 2, dashStyle:'ShortDash', label: {text: 'Warning'} },
//                 { value: 90, color: '#ef4444', width: 2, dashStyle:'ShortDash', label: {text: 'Critical'} }
//             ]
//         },
//         legend: {
//             enabled: true,
//             align: 'center',
//             verticalAlign: 'bottom',
//             layout: 'horizontal',
//             itemStyle: { cursor: 'pointer' }
//         },
//         tooltip: { shared: true, valueSuffix: '%' },
//         plotOptions: {
//             series: {
//                 events: {
//                     legendItemClick: function () {
//                         if (this.visible) this.hide();
//                         else this.show();
//                         return false;
//                     }
//                 }
//             }
//         },
//         series: cpuDatasets,
//         credits: { enabled: false }
//     });

//     // Memory Chart
//     Highcharts.chart('memoryChart', {
//         chart: {
//             type: 'line',
//             zoomType: 'x'
//         },
//         title: { text: 'Memory Usage Trend' },
//         xAxis: {
//             categories: labels,
//             labels: { rotation: -45 }
//         },
//         yAxis: {
//             min: 0,
//             max: 100,
//             title: { text: 'Memory Usage (%)' }
//         },
//         legend: {
//             enabled: true,
//             align: 'center',
//             verticalAlign: 'bottom',
//             layout: 'horizontal',
//             itemStyle: { cursor: 'pointer' }
//         },
//         tooltip: { shared: true, valueSuffix: '%' },
//         plotOptions: {
//             series: {
//                 events: {
//                     legendItemClick: function () {
//                         if (this.visible) this.hide();
//                         else this.show();
//                         return false;
//                     }
//                 }
//             }
//         },
//         series: memDatasets,
//         credits: { enabled: false }
//     });
// }

// //================== user tracking ===================

// function drawCPULineChart(containerId, labels, serverNames, dataSets) {
//     Highcharts.chart(containerId, {
//         chart: {
//             type: 'line',
//             backgroundColor: 'transparent',
//             height: 350,
//             zoomType: 'x'
//         },
//         title: {
//             text: 'CPU Usage Trend'
//         },
//         xAxis: {
//             categories: labels,
//             labels: {
//                 rotation: -45,
//                 style: { fontSize: '12px' }
//             },
//             title: { text: 'Time' }
//         },
//         yAxis: {
//             min: 0,
//             max: 100,
//             title: {
//                 text: 'CPU Usage (%)'
//             },
//             labels: {
//                 format: '{value}%',
//                 style: { fontSize: '12px' }
//             },
//             plotLines: [{
//                 value: 70,
//                 color: '#f59e0b',
//                 width: 2,
//                 dashStyle: 'ShortDash',
//                 label: {
//                     text: 'Warning Threshold',
//                     style: { color: '#f59e0b' }
//                 }
//             },{
//                 value: 90,
//                 color: '#ef4444',
//                 width: 2,
//                 dashStyle: 'ShortDash',
//                 label: {
//                     text: 'Critical Threshold',
//                     style: { color: '#ef4444' }
//                 }
//             }]
//         },
//         legend: {
//             enabled: true,
//             align: 'center',
//             verticalAlign: 'bottom',
//             layout: 'horizontal',
//             itemStyle: {
//                 cursor: 'pointer',
//                 fontSize: '12px'
//             }
//         },
//         tooltip: {
//             shared: true,
//             valueSuffix: '%',
//             crosshairs: true,
//             style: {
//                 fontSize: '14px'
//             }
//         },
//         plotOptions: {
//             series: {
//                 cursor: 'pointer',
//                 events: {
//                     legendItemClick: function () {
//                         // Toggle individual series visibility
//                         if (this.visible) {
//                             this.hide();
//                         } else {
//                             this.show();
//                         }
//                         return false; // prevent default toggle behavior
//                     }
//                 }
//             }
//         },
//         credits: { enabled: false },
//         series: dataSets.map((data, index) => ({
//             name: serverNames[index],
//             data: data,
//             lineWidth: 2,
//             marker: { radius: 4 },
//             visible: true,
//             color: Highcharts.getOptions().colors[index % Highcharts.getOptions().colors.length]
//         }))
//     });
// }

// function loadUserTracking() {
//     fetch('/api/user_tracking')
//         .then(response => response.json())
//         .then(data => {
//             const container = document.getElementById('user-tracking-container');
//             if (!data.users || data.users.length === 0) {
//                 container.innerHTML = '<p>No user tracking data available</p>';
//                 return;
//             }

//             let html = '<table class="stats-table"><thead><tr><th>User IP</th><th>User Name</th><th>Total Servers</th><th>Total Time (hours)</th><th>Servers Details</th></tr></thead><tbody>';

//             data.users.forEach(user => {
//                 const serversDetails = user.servers.map(srv => {
//                     return `<div><b>${srv.server_name}</b> (Sessions: ${srv.session_count})<br>
//                             First Seen: ${new Date(srv.first_seen).toLocaleString()}<br>
//                             Last Seen: ${new Date(srv.last_seen).toLocaleString()}</div>`;
//                 }).join('<hr>');

//                 html += `<tr>
//                     <td>${user.user_ip}</td>
//                     <td>${user.user_name}</td>
//                     <td>${user.total_servers}</td>
//                     <td>${user.total_time_hours}</td>
//                     <td>${serversDetails}</td>
//                 </tr>`;
//             });

//             html += '</tbody></table>';
//             container.innerHTML = html;
//         })
//         .catch(error => {
//             console.error('Error loading user tracking:', error);
//             document.getElementById('user-tracking-container').innerHTML = '<p>Error loading user tracking data.</p>';
//         });
// }

// // ==================== Initialize ====================
// document.addEventListener("DOMContentLoaded", () => {
//   initNavigation();
//   initSidebarToggle();
//   initThemeSwitcher();
//   initSearch();
//   loadSettings();

//   updateTimeDisplay();
//   updateServers();

//   setInterval(updateTimeDisplay, 1000);
//   window.refreshTimer = setInterval(updateServers, refreshInterval);

//   document.getElementById("server-modal").addEventListener("click", (e) => {
//     if (e.target.id === "server-modal") {
//       closeModal();
//     }
//   });
// });

// ==================== Global Variables ====================
let currentServer = null;
let refreshInterval = 5000;
let liveCPUChart = null;
let liveCPUData = [];
let liveCPUInterval = null;
let isCompactView = false;
let showOfflineServers = true;

const API_BASE = "/monitoring_server";

const IP_NAME_MAP = {
  "192.168.2.202": "Mihir",
  "192.168.2.220": "Harish",
  "192.168.2.141": "Vikrant",
  "192.168.2.221": "Karnav",
  "192.168.2.205": "Vidit",
  "192.168.2.210": "Arpan",
};

// ==================== Settings Management ====================
function loadSettings() {
  const settings = localStorage.getItem("monitorSettings");
  if (settings) {
    const parsed = JSON.parse(settings);
    refreshInterval = parsed.refreshInterval * 1000 || 5000;
    isCompactView = parsed.compactView || false;
    showOfflineServers = parsed.showOffline !== false;

    document.getElementById("refresh-interval").value =
      parsed.refreshInterval || 5;
    document.getElementById("cpu-warning").value = parsed.cpuWarning || 70;
    document.getElementById("cpu-critical").value = parsed.cpuCritical || 90;
    document.getElementById("mem-warning").value = parsed.memWarning || 75;
    document.getElementById("mem-critical").value = parsed.memCritical || 90;
    document.getElementById("show-offline").checked = showOfflineServers;
    document.getElementById("compact-view").checked = isCompactView;

    applyCompactView();
  }
}

function saveSettings() {
  const settings = {
    refreshInterval: parseInt(
      document.getElementById("refresh-interval").value
    ),
    cpuWarning: parseInt(document.getElementById("cpu-warning").value),
    cpuCritical: parseInt(document.getElementById("cpu-critical").value),
    memWarning: parseInt(document.getElementById("mem-warning").value),
    memCritical: parseInt(document.getElementById("mem-critical").value),
    showOffline: document.getElementById("show-offline").checked,
    compactView: document.getElementById("compact-view").checked,
  };

  localStorage.setItem("monitorSettings", JSON.stringify(settings));
  refreshInterval = settings.refreshInterval * 1000;
  isCompactView = settings.compactView;
  showOfflineServers = settings.showOffline;

  applyCompactView();
  alert("Settings saved successfully!");

  clearInterval(window.refreshTimer);
  window.refreshTimer = setInterval(updateServers, refreshInterval);
}

function applyCompactView() {
  if (isCompactView) {
    document.body.classList.add("compact-view");
  } else {
    document.body.classList.remove("compact-view");
  }
}

// ==================== Helper Functions ====================
function getCPUStatus(cpuPercent) {
  if (cpuPercent === null || cpuPercent === undefined) return "";
  const cpu = parseFloat(cpuPercent);
  if (isNaN(cpu)) return "";
  if (cpu >= 90) return "critical";
  if (cpu >= 70) return "warning";
  if (cpu >= 50) return "moderate";
  return "normal";
}

function calculateMemoryPercent(used, total) {
  if (!used || !total || isNaN(used) || isNaN(total) || total === 0) return 0;
  used = Math.max(0, parseFloat(used));
  total = Math.max(0, parseFloat(total));
  const percent = (used / total) * 100;
  return Math.max(0, Math.min(100, percent));
}

function formatBytes(bytes, decimals = 2) {
  if (bytes === null || bytes === undefined || isNaN(bytes)) return "N/A";
  bytes = Number(bytes);
  if (isNaN(bytes) || bytes === 0) return "N/A";

  const k = 1024;
  const dm = decimals < 0 ? 0 : decimals;
  const sizes = ["B", "KB", "MB", "GB", "TB", "PB"];

  if (bytes < 1) return "0 B";

  const i = Math.floor(Math.log(bytes) / Math.log(k));
  const sizeIndex = Math.min(i, sizes.length - 1);

  return (
    parseFloat((bytes / Math.pow(k, sizeIndex)).toFixed(dm)) +
    " " +
    sizes[sizeIndex]
  );
}

function getStorageBarColor(status) {
  switch (status) {
    case "critical":
      return "#ef4444";
    case "warning":
      return "#f59e0b";
    case "moderate":
      return "#3b82f6";
    case "normal":
      return "#10b981";
    default:
      return "#9ca3af";
  }
}

function validateMemoryData(memory) {
  if (!memory) return null;
  return {
    total: Number(memory.total) || 0,
    used: Number(memory.used) || 0,
    free: Number(memory.free) || 0,
    buffers: Number(memory.buffers) || 0,
    cached: Number(memory.cached) || 0,
    status: memory.status || "normal",
  };
}

function drawMemoryPieChart(canvas, memoryData) {
  if (!canvas || !memoryData) return;

  const existingChart = Chart.getChart(canvas);
  if (existingChart) existingChart.destroy();

  const ctx = canvas.getContext("2d");
  const total = Math.abs(parseFloat(memoryData.total)) || 0;
  const used = Math.max(0, parseFloat(memoryData.used));
  const cached = Math.max(0, parseFloat(memoryData.cached));
  const buffers = Math.max(0, parseFloat(memoryData.buffers));
  const free = Math.max(0, parseFloat(memoryData.free));

  const data = [
    Math.max(0, Math.min(used, total)),
    Math.max(0, Math.min(cached, total)),
    Math.max(0, Math.min(buffers, total)),
    Math.max(0, Math.min(free, total)),
  ];

  new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Used", "Cached", "Buffers", "Free"],
      datasets: [
        {
          data: data,
          backgroundColor: ["#ef4444", "#3b82f6", "#f59e0b", "#10b981"],
          borderWidth: 0,
          borderColor: "transparent",
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      cutout: "65%",
      plugins: {
        legend: { display: false },
        tooltip: {
          enabled: true,
          callbacks: {
            label: (context) => {
              const value = context.raw;
              const percentage = calculateMemoryPercent(value, total);
              return `${context.label}: ${formatBytes(
                value
              )} (${percentage.toFixed(1)}%)`;
            },
          },
        },
      },
      animation: {
        animateRotate: true,
        animateScale: false,
      },
    },
  });
}

// ==================== Navigation ====================
function initNavigation() {
  const navItems = document.querySelectorAll(".nav-item");
  const pages = document.querySelectorAll(".page-content");

  navItems.forEach((item) => {
    item.addEventListener("click", (e) => {
      e.preventDefault();
      const page = item.getAttribute("data-page");

      navItems.forEach((nav) => nav.classList.remove("active"));
      item.classList.add("active");

      pages.forEach((p) => p.classList.remove("active"));
      document.getElementById(`${page}-page`).classList.add("active");

      if (page === "alerts") loadAlerts();
      if (page === "analytics") loadAnalytics();
      if (page === "servers") loadAllServers();
      if (page === "user-tracking") loadUserTracking();
    });
  });
}

// ==================== Sidebar Toggle ====================
function initSidebarToggle() {
  const toggle = document.getElementById("sidebarToggle");
  const sidebar = document.getElementById("sidebar");

  toggle.addEventListener("click", () => {
    sidebar.classList.toggle("show");
  });

  document.addEventListener("click", (e) => {
    if (window.innerWidth <= 1024) {
      if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
        sidebar.classList.remove("show");
      }
    }
  });
}

// ==================== Theme Switcher ====================
function initThemeSwitcher() {
  const themeButtons = document.querySelectorAll(".theme-btn");
  const savedTheme = localStorage.getItem("theme") || "dark";

  document.body.className = `theme-${savedTheme}`;
  themeButtons.forEach((btn) => {
    if (btn.getAttribute("data-theme") === savedTheme) {
      btn.classList.add("active");
    }
  });

  themeButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const theme = btn.getAttribute("data-theme");
      document.body.className = `theme-${theme}`;
      localStorage.setItem("theme", theme);

      themeButtons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
    });
  });
}

// ==================== Time Display ====================
function updateTimeDisplay() {
  fetch(`${API_BASE}/api/time`)
    .then((response) => response.json())
    .then((data) => {
      const timeElement = document.getElementById("current-time");
      if (timeElement && data.timestamp) {
        const [dateStr, timeStr] = data.timestamp.split(" ");
        const [year, month, day] = dateStr.split("-").map(Number);
        const [hour, minute, second] = timeStr.split(":").map(Number);

        const utcDate = new Date(
          Date.UTC(year, month - 1, day, hour, minute, second)
        );

        const options = {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: false,
          timeZone: "Asia/Kolkata",
        };

        const istDateTime = utcDate.toLocaleString("en-GB", options);
        const [d, m, y] = istDateTime.split(",")[0].split("/");
        const t = istDateTime.split(",")[1].trim();

        timeElement.textContent = `${y}-${m}-${d} ${t}`;
      }
    })
    .catch((error) => console.error("Error updating time:", error));
}

// ==================== Update Servers ====================
function updateServers() {
  fetch(`${API_BASE}/api/status`)
    .then((response) => response.json())
    .then((data) => {
      updateStats(data.servers);

      const groups = {};
      data.servers.forEach((server) => {
        if (!showOfflineServers && server.status === "offline") return;
        const group = server.group || "default";
        if (!groups[group]) groups[group] = [];
        groups[group].push(server);
      });

      const container = document.getElementById("servers-container");
      container.innerHTML = "";

      Object.keys(groups).forEach((groupName) => {
        const groupSection = createGroupSection(groupName, groups[groupName]);
        container.appendChild(groupSection);
      });
    })
    .catch((error) => {
      console.error("Error fetching servers:", error);
    });
}

function updateStats(servers) {
  const total = servers.length;
  const online = servers.filter((s) => s.status === "online").length;

  let totalCPU = 0;
  let cpuCount = 0;
  const alertServersSet = new Set();

  servers.forEach((server) => {
    let hasAlert = false;

    if (server.status === "online") {
      if (server.cpu !== null && server.cpu !== undefined) {
        totalCPU += server.cpu;
        cpuCount++;

        if (server.cpu > 75) {
          hasAlert = true;
        }
      }

      if (server.memory && server.memory.usage_percent > 75) {
        hasAlert = true;
      }

      if (server.storage) {
        for (let storage of server.storage) {
          if (storage.mountpoint === "/" && storage.percent > 75) {
            hasAlert = true;
            break;
          }
        }
      }
    } else {
      hasAlert = true;
    }

    if (hasAlert) {
      alertServersSet.add(server.name);
    }
  });

  const alertCount = alertServersSet.size;

  document.getElementById("total-servers").textContent = total;
  document.getElementById("online-servers").textContent = online;
  document.getElementById("alert-servers").textContent = alertCount;
  document.getElementById("avg-cpu").textContent =
    cpuCount > 0 ? (totalCPU / cpuCount).toFixed(1) + "%" : "0%";
  document.getElementById("alert-badge").textContent = alertCount;
}

function createGroupSection(groupName, servers) {
  const section = document.createElement("div");
  section.className = "server-group";

  const groupIcons = {
    data: "fa-database",
    deployment: "fa-rocket",
    stagging: "fa-flask",
    gpus: "fa-brain",
    nginx: "fa-server",
    development: "fa-code",
  };

  section.innerHTML = `
        <div class="group-header">
            <i class="fas ${groupIcons[groupName] || "fa-server"}"></i>
            <h2>${groupName.charAt(0).toUpperCase() + groupName.slice(1)}</h2>
            <span class="server-count">${servers.length} server${
    servers.length !== 1 ? "s" : ""
  }</span>
        </div>
        <div class="servers-grid" id="group-${groupName}"></div>
    `;

  const grid = section.querySelector(".servers-grid");
  servers.forEach((server) => {
    const card = createServerCard(server);
    grid.appendChild(card);
  });

  return section;
}

function createServerCard(server) {
  const card = document.createElement("div");
  card.className = `server-card ${server.status} slide-up`;
  card.onclick = () => showServerDetails(server.name);

  const memory = validateMemoryData(server.memory);
  const cpuStatus = getCPUStatus(server.cpu);

  // Safe CPU value
  const cpuValue =
    server.cpu !== null && server.cpu !== undefined
      ? server.cpu.toFixed(1) + "%"
      : "N/A";
  const cpuPercent = server.cpu || 0;

  // Safe memory value
  const memValue = memory
    ? calculateMemoryPercent(memory.used, memory.total).toFixed(1) + "%"
    : "N/A";
  const memPercent = memory
    ? calculateMemoryPercent(memory.used, memory.total)
    : 0;
  const memStatus = memory ? memory.status : "";

  // Get ROOT storage (/ or /root) - THIS IS THE FIX!
  let storageValue = "N/A";
  let storagePercent = 0;
  let storageStatus = "";

  if (server.storage && server.storage.length > 0) {
    // Find root partition (mountpoint = '/' or '/root')
    const rootStorage = server.storage.find(
      (s) => s.mountpoint === "/" || s.mountpoint === "/root"
    );

    if (
      rootStorage &&
      rootStorage.percent !== null &&
      rootStorage.percent !== undefined
    ) {
      storagePercent = rootStorage.percent;
      storageValue = storagePercent.toFixed(1) + "%";
      storageStatus = rootStorage.status || "";
    }
  }

  // Determine blink classes
  const cpuBlinkClass =
    cpuPercent >= 90
      ? "blink-critical"
      : cpuPercent >= 70
      ? "blink-warning"
      : "";
  const memBlinkClass =
    memPercent >= 90
      ? "blink-critical"
      : memPercent >= 75
      ? "blink-warning"
      : "";
  const storageBlinkClass =
    storagePercent >= 90
      ? "blink-critical"
      : storagePercent >= 80
      ? "blink-warning"
      : "";

  card.innerHTML = `
        <div class="server-header">
            <h3>${server.name}</h3>
            <span class="status-badge ${server.status}">${server.status}</span>
        </div>
        <div class="server-stats">
            <div class="stat ${cpuBlinkClass}">
                <span class="stat-label">CPU</span>
                <span class="stat-value ${cpuStatus}">${cpuValue}</span>
            </div>
            <div class="stat ${memBlinkClass}">
                <span class="stat-label">Memory</span>
                <span class="stat-value ${memStatus}">${memValue}</span>
            </div>
            <div class="stat ${storageBlinkClass}">
                <span class="stat-label">Storage</span>
                <span class="stat-value ${storageStatus}">${storageValue}</span>
            </div>
        </div>
    `;

  return card;
}

// ==================== Live CPU Chart Functions ====================
function initLiveCPUChart(serverName, initialCPU) {
  liveCPUData = [];
  const now = new Date().getTime();
  liveCPUData.push([now, initialCPU]);

  liveCPUChart = Highcharts.chart("live-cpu-chart", {
    chart: {
      type: "areaspline",
      backgroundColor: "transparent",
      height: 280,
      animation: Highcharts.svg,
    },
    title: { text: null },
    xAxis: {
      type: "datetime",
      tickPixelInterval: 150,
      gridLineColor: "rgba(255, 255, 255, 0.05)",
      labels: {
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
    },
    yAxis: {
      title: {
        text: "CPU Usage (%)",
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-primary"
          ),
        },
      },
      min: 0,
      max: 100,
      gridLineColor: "rgba(255, 255, 255, 0.05)",
      labels: {
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
      plotLines: [
        {
          value: 70,
          color: "#f59e0b",
          dashStyle: "shortdash",
          width: 2,
          label: {
            text: "Warning",
            style: { color: "#f59e0b" },
          },
        },
        {
          value: 90,
          color: "#ef4444",
          dashStyle: "shortdash",
          width: 2,
          label: {
            text: "Critical",
            style: { color: "#ef4444" },
          },
        },
      ],
    },
    legend: { enabled: false },
    credits: { enabled: false },
    exporting: { enabled: false },
    tooltip: {
      formatter: function () {
        return (
          "<b>" +
          Highcharts.dateFormat("%H:%M:%S", this.x) +
          "</b><br/>" +
          "CPU: " +
          this.y.toFixed(1) +
          "%"
        );
      },
      backgroundColor: "rgba(0, 0, 0, 0.8)",
      style: { color: "#fff" },
    },
    series: [
      {
        name: "CPU Usage",
        data: liveCPUData,
        color: {
          linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
          stops: [
            [0, "#667eea"],
            [1, "rgba(102, 126, 234, 0.1)"],
          ],
        },
        fillOpacity: 0.3,
        lineWidth: 2,
        marker: {
          enabled: false,
          states: {
            hover: {
              enabled: true,
              radius: 5,
            },
          },
        },
      },
    ],
  });

  startLiveCPUUpdates(serverName);
}

function startLiveCPUUpdates(serverName) {
  if (liveCPUInterval) {
    clearInterval(liveCPUInterval);
  }

  liveCPUInterval = setInterval(() => {
    fetch(`${API_BASE}/api/status`)
      .then((response) => response.json())
      .then((data) => {
        const server = data.servers.find((s) => s.name === serverName);
        if (server && server.cpu !== null && server.cpu !== undefined) {
          updateLiveCPUChart(server.cpu);

          const displayElement = document.querySelector(".cpu-value-large");
          if (displayElement) {
            displayElement.textContent = server.cpu.toFixed(1) + "%";
            displayElement.className =
              "cpu-value-large " + getCPUStatus(server.cpu);
          }
        }
      })
      .catch((error) => console.error("Error updating live CPU:", error));
  }, 2000);
}

function updateLiveCPUChart(cpuValue) {
  if (!liveCPUChart) return;

  const now = new Date().getTime();
  const series = liveCPUChart.series[0];

  series.addPoint([now, cpuValue], true, liveCPUData.length > 30);

  if (liveCPUData.length > 30) {
    liveCPUData.shift();
  }
  liveCPUData.push([now, cpuValue]);
}

function stopLiveCPUUpdates() {
  if (liveCPUInterval) {
    clearInterval(liveCPUInterval);
    liveCPUInterval = null;
  }
}

// ==================== Server Details Modal ====================
function showServerDetails(serverName) {
  showLoading();

  fetch(`${API_BASE}/api/status`)
    .then((response) => response.json())
    .then((data) => {
      const server = data.servers.find((s) => s.name === serverName);
      if (server) {
        currentServer = server;
        openModal(server);
      }
      hideLoading();
    })
    .catch((error) => {
      console.error("Error:", error);
      hideLoading();
    });
}

function openModal(server) {
  const modal = document.getElementById("server-modal");
  document.getElementById("modal-server-name").textContent = server.name;

  modal.classList.add("show");
  setupTabs();
  renderOverviewTab(server);
}

function closeModal() {
  document.getElementById("server-modal").classList.remove("show");
  stopLiveCPUUpdates();
  if (liveCPUChart) {
    liveCPUChart.destroy();
    liveCPUChart = null;
  }
}

function setupTabs() {
  const tabs = document.querySelectorAll(".tabs .tab");
  const contents = document.querySelectorAll(".tab-content");

  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const tabName = tab.getAttribute("data-tab");

      tabs.forEach((t) => t.classList.remove("active"));
      tab.classList.add("active");

      contents.forEach((c) => c.classList.remove("active"));
      document.getElementById(`${tabName}-tab`).classList.add("active");

      if (tabName !== "overview") {
        stopLiveCPUUpdates();
      }

      switch (tabName) {
        case "overview":
          renderOverviewTab(currentServer);
          break;
        case "storage":
          renderStorageTab(currentServer);
          break;
        case "processes":
          renderProcessesTab(currentServer);
          break;
        case "services":
          renderServicesTab(currentServer);
          break;
        case "ssh":
          renderSSHTab(currentServer);
          break;
      }
    });
  });
}

function renderOverviewTab(server) {
  const memory = validateMemoryData(server.memory);
  const cpuStatus = getCPUStatus(server.cpu);
  const cpuValue =
    server.cpu !== null && server.cpu !== undefined
      ? server.cpu.toFixed(1) + "%"
      : "N/A";

  let html = `
        <div class="overview-stats">
            <div class="stat-section-grid">
                <div class="stat-section">
                    <h3><i class="fas fa-microchip"></i> Live CPU Usage</h3>
                    <div class="live-cpu-container">
                        <div id="live-cpu-chart"></div>
                        <div class="current-cpu-display">
                            <div class="cpu-value-large ${cpuStatus}">${cpuValue}</div>
                            <div class="cpu-label">Current Usage</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-section">
                    <h3><i class="fas fa-memory"></i> Memory Usage</h3>
                    ${
                      memory
                        ? `
                        <div class="memory-container">
                            <div class="memory-chart-wrapper">
                                <canvas id="memory-chart"></canvas>
                            </div>
                            <div class="memory-stats">
                                <div class="memory-stat">
                                    <span class="memory-label" style="background: #ef4444;"></span>
                                    <span>Used: ${formatBytes(
                                      memory.used
                                    )}</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="memory-label" style="background: #3b82f6;"></span>
                                    <span>Cached: ${formatBytes(
                                      memory.cached
                                    )}</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="memory-label" style="background: #f59e0b;"></span>
                                    <span>Buffers: ${formatBytes(
                                      memory.buffers
                                    )}</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="memory-label" style="background: #10b981;"></span>
                                    <span>Free: ${formatBytes(
                                      memory.free
                                    )}</span>
                                </div>
                                <div class="memory-total">
                                    Total: ${formatBytes(memory.total)}
                                </div>
                            </div>
                        </div>
                    `
                        : "<p>Memory data not available</p>"
                    }
                </div>
            </div>

            ${
              server.load_average
                ? `
                <div class="stat-section">
                    <h3><i class="fas fa-tachometer-alt"></i> System Load</h3>
                    <div class="stat-grid">
                        <div class="stat-box">
                            <div class="stat-label">1 min</div>
                            <div class="stat-value">${server.load_average.load_1min}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">5 min</div>
                            <div class="stat-value">${server.load_average.load_5min}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">15 min</div>
                            <div class="stat-value">${server.load_average.load_15min}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Processes</div>
                            <div class="stat-value">${server.load_average.running_processes}/${server.load_average.total_processes}</div>
                        </div>
                    </div>
                </div>
            `
                : ""
            }

            ${
              server.uptime
                ? `
                <div class="stat-section">
                    <h3><i class="fas fa-clock"></i> Uptime</h3>
                    <div class="stat-box">
                        <div class="stat-label">Running Since</div>
                        <div class="stat-value">${server.uptime.uptime_human}</div>
                        <div class="stat-label" style="margin-top: 0.5rem;">Boot Time: ${server.uptime.boot_time}</div>
                    </div>
                </div>
            `
                : ""
            }

            ${
              server.network_stats && server.network_stats.length > 0
                ? `
                <div class="stat-section">
                    <h3><i class="fas fa-network-wired"></i> Network Interfaces</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Interface</th>
                                <th>RX (MB)</th>
                                <th>TX (MB)</th>
                                <th>Packets</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${server.network_stats
                              .map((net) => {
                                const rxMB = (
                                  net.rx_bytes /
                                  (1024 * 1024)
                                ).toFixed(2);
                                const txMB = (
                                  net.tx_bytes /
                                  (1024 * 1024)
                                ).toFixed(2);
                                return `
                                    <tr>
                                        <td><strong>${net.interface}</strong></td>
                                        <td>${rxMB} MB</td>
                                        <td>${txMB} MB</td>
                                        <td>${net.rx_packets} ${net.tx_packets}</td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `
                : ""
            }

            ${
              server.top_cpu_processes && server.top_cpu_processes.length > 0
                ? `
                <div class="stat-section">
                    <h3><i class="fas fa-microchip"></i> Top CPU Processes</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>PID</th>
                                <th>User</th>
                                <th>CPU %</th>
                                <th>MEM %</th>
                                <th>Command</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${server.top_cpu_processes
                              .map(
                                (proc) => `
                                <tr>
                                    <td>${proc.pid}</td>
                                    <td>${proc.user}</td>
                                    <td><strong>${proc.cpu}%</strong></td>
                                    <td>${proc.mem}%</td>
                                    <td><code>${proc.command}</code></td>
                                </tr>
                            `
                              )
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `
                : ""
            }

            ${
              server.top_mem_processes && server.top_mem_processes.length > 0
                ? `
                <div class="stat-section">
                    <h3><i class="fas fa-memory"></i> Top Memory Processes</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>PID</th>
                                <th>User</th>
                                <th>CPU %</th>
                                <th>MEM %</th>
                                <th>Command</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${server.top_mem_processes
                              .map(
                                (proc) => `
                                <tr>
                                    <td>${proc.pid}</td>
                                    <td>${proc.user}</td>
                                    <td>${proc.cpu}%</td>
                                    <td><strong>${proc.mem}%</strong></td>
                                    <td><code>${proc.command}</code></td>
                                </tr>
                            `
                              )
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `
                : ""
            }
        </div>
    `;

  document.getElementById("overview-tab").innerHTML = html;

  if (memory) {
    setTimeout(() => {
      const canvas = document.getElementById("memory-chart");
      if (canvas) {
        drawMemoryPieChart(canvas, memory);
      }
    }, 100);
  }

  if (server.cpu !== null && server.cpu !== undefined) {
    initLiveCPUChart(server.name, server.cpu);
  }
}

function renderStorageTab(server) {
    if (!server.storage || server.storage.length === 0) {
        document.getElementById('storage-tab').innerHTML = `
            <div class="empty-storage-state">
                <i class="fas fa-hdd fa-4x"></i>
                <h3>No Storage Data</h3>
                <p>Storage information is not available for this server</p>
            </div>
        `;
        return;
    }
    
    const html = `
        <div class="storage-header-section">
            <h3><i class="fas fa-database"></i> Storage Overview</h3>
            <div class="storage-stats-summary">
                <div class="storage-summary-item">
                    <i class="fas fa-hdd"></i>
                    <span>${server.storage.length} Partitions</span>
                </div>
                <div class="storage-summary-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${server.storage.filter(s => s.status !== 'normal').length} Alerts</span>
                </div>
            </div>
        </div>
        
        <div class="storage-cards-grid">
            ${server.storage.map((drive, index) => {
                const usedPercent = drive.percent || 0;
                
                return `
                    <div class="storage-card-modern ${drive.status}">
                        <div class="storage-card-header">
                            <div class="storage-icon-wrapper">
                                <i class="fas ${drive.mountpoint === '/' ? 'fa-hard-drive' : 'fa-folder'}"></i>
                            </div>
                            <div class="storage-title-section">
                                <h4>${drive.mountpoint}</h4>
                                <span class="storage-filesystem">${drive.filesystem}</span>
                            </div>
                            <span class="storage-status-badge ${drive.status}">
                                ${drive.status}
                            </span>
                        </div>
                        
                        <div class="storage-visualization">
                            <canvas id="storage-chart-${index}" class="storage-mini-chart"></canvas>
                            <div class="storage-center-info">
                                <div class="storage-percent-large">${usedPercent.toFixed(1)}%</div>
                                <div class="storage-percent-label">Used</div>
                            </div>
                        </div>
                        
                        <div class="storage-details-grid">
                            <div class="storage-detail-item">
                                <i class="fas fa-database"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Total</span>
                                    <span class="storage-detail-value">${formatBytes(drive.size)}</span>
                                </div>
                            </div>
                            <div class="storage-detail-item">
                                <i class="fas fa-chart-pie"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Used</span>
                                    <span class="storage-detail-value">${formatBytes(drive.used)}</span>
                                </div>
                            </div>
                            <div class="storage-detail-item">
                                <i class="fas fa-check-circle"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Free</span>
                                    <span class="storage-detail-value">${formatBytes(drive.available)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="storage-progress-bar">
                            <div class="storage-progress-fill ${drive.status}" style="width: ${usedPercent}%">
                                <span class="storage-progress-text">${usedPercent.toFixed(1)}%</span>
                            </div>
                        </div>
                        
                        <button class="storage-analyze-btn" onclick="analyzeStorage('${server.name}', '${drive.mountpoint}')">
                            <i class="fas fa-search-plus"></i>
                            <span>Analyze Storage</span>
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
    
    document.getElementById('storage-tab').innerHTML = html;
    
    // Draw mini charts for each storage
    server.storage.forEach((drive, index) => {
        setTimeout(() => {
            drawStorageMiniChart(index, drive.percent, drive.status);
        }, 100);
    });
}

function drawStorageMiniChart(index, usedPercent, status) {
    const canvas = document.getElementById(`storage-chart-${index}`);
    if (!canvas) {
        console.error(`Canvas not found: storage-chart-${index}`);
        return;
    }
    
    const ctx = canvas.getContext('2d');
    canvas.width = 160;
    canvas.height = 160;
    
    const freePercent = 100 - usedPercent;
    
    // Color based on status
    let usedColor = '#10b981'; // green
    let freeColor = '#e5e7eb';
    
    if (status === 'critical') {
        usedColor = '#ef4444'; // red
    } else if (status === 'warning') {
        usedColor = '#f59e0b'; // orange
    } else if (status === 'moderate') {
        usedColor = '#3b82f6'; // blue
    }
    
    // Check if Chart is defined
    if (typeof Chart === 'undefined') {
        console.error('Chart.js is not loaded!');
        // Draw simple text fallback
        ctx.fillStyle = '#fff';
        ctx.font = '20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`${usedPercent.toFixed(1)}%`, 80, 80);
        return;
    }
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Used', 'Free'],
            datasets: [{
                data: [usedPercent, freePercent],
                backgroundColor: [usedColor, freeColor],
                borderWidth: 0
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            cutout: '75%',
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
            }
        }
    });
}

function analyzeStorage(serverName, mountpoint) {
  // Show modal with loading state
  const modal = document.getElementById('server-modal');
  const modalTitle = document.getElementById('modal-server-name');
  const overviewTab = document.getElementById('overview-tab');
  
  modalTitle.textContent = `Storage Analysis: ${serverName} - ${mountpoint}`;
  modal.classList.add('show');
  
  // Hide tabs temporarily
  document.querySelectorAll('.tabs').forEach(tab => tab.style.display = 'none');
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  overviewTab.classList.add('active');
  overviewTab.innerHTML = `
    <div class="analysis-loading-state">
      <div class="loading-spinner"></div>
      <p>Analyzing storage usage for ${mountpoint}...</p>
      <p class="loading-subtext">This may take a few moments...</p>
    </div>
  `;
  
  // Fetch analysis
  fetch(`${API_BASE}/api/analyze_storage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      server: serverName,
      mountpoint: mountpoint
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      displayStorageAnalysisModal(data);
    } else {
      overviewTab.innerHTML = `
        <div class="analysis-error-state">
          <i class="fas fa-exclamation-triangle fa-3x"></i>
          <h3>Analysis Failed</h3>
          <p>${data.error || 'Failed to analyze storage'}</p>
        </div>
      `;
    }
  })
  .catch(error => {
    console.error('Error:', error);
    overviewTab.innerHTML = `
      <div class="analysis-error-state">
        <i class="fas fa-exclamation-triangle fa-3x"></i>
        <h3>Connection Error</h3>
        <p>Failed to connect to server for analysis</p>
      </div>
    `;
  });
}

function displayStorageAnalysisModal(data) {
  const overviewTab = document.getElementById('overview-tab');
  const analysis = data.analysis;
  
  let html = `
    <div class="storage-analysis-container">
      <div class="analysis-summary-cards">
        <div class="analysis-summary-card">
          <div class="summary-icon"><i class="fas fa-folder"></i></div>
          <div class="summary-info">
            <div class="summary-value">${analysis.top_directories.length}</div>
            <div class="summary-label">Directories Analyzed</div>
          </div>
        </div>
        <div class="analysis-summary-card">
          <div class="summary-icon"><i class="fas fa-file"></i></div>
          <div class="summary-info">
            <div class="summary-value">${analysis.top_files.length}</div>
            <div class="summary-label">Files Analyzed</div>
          </div>
        </div>
        <div class="analysis-summary-card">
          <div class="summary-icon"><i class="fas fa-chart-bar"></i></div>
          <div class="summary-info">
            <div class="summary-value">${analysis.file_types.length}</div>
            <div class="summary-label">File Types Found</div>
          </div>
        </div>
      </div>
      
      <div class="analysis-tabs-modern">
        <button class="analysis-tab-btn active" onclick="switchAnalysisTab(event, 'dirs')">
          <i class="fas fa-folder-tree"></i> Top Directories
        </button>
        <button class="analysis-tab-btn" onclick="switchAnalysisTab(event, 'files')">
          <i class="fas fa-file-alt"></i> Largest Files
        </button>
        <button class="analysis-tab-btn" onclick="switchAnalysisTab(event, 'types')">
          <i class="fas fa-chart-pie"></i> File Types
        </button>
        <button class="analysis-tab-btn" onclick="switchAnalysisTab(event, 'summary')">
          <i class="fas fa-layer-group"></i> Directory Summary
        </button>
      </div>
      
      <div class="analysis-content-wrapper">
        <div class="analysis-section active" id="analysis-dirs">
          <h3><i class="fas fa-folder-open"></i> Top 20 Largest Directories</h3>
          <div class="analysis-table-wrapper">
            <table class="modern-table">
              <thead>
                <tr>
                  <th width="60">#</th>
                  <th width="120">Size</th>
                  <th>Path</th>
                </tr>
              </thead>
              <tbody>
                ${analysis.top_directories.map((dir, index) => `
                  <tr>
                    <td><span class="rank-badge">${index + 1}</span></td>
                    <td><span class="size-tag">${dir.size}</span></td>
                    <td><code class="path-code">${dir.path}</code></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="analysis-section" id="analysis-files">
          <h3><i class="fas fa-file-code"></i> Top 20 Largest Files</h3>
          <div class="analysis-table-wrapper">
            <table class="modern-table">
              <thead>
                <tr>
                  <th width="60">#</th>
                  <th width="120">Size</th>
                  <th>Path</th>
                </tr>
              </thead>
              <tbody>
                ${analysis.top_files.map((file, index) => `
                  <tr>
                    <td><span class="rank-badge">${index + 1}</span></td>
                    <td><span class="size-tag">${file.size}</span></td>
                    <td><code class="path-code">${file.path}</code></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="analysis-section" id="analysis-types">
          <h3><i class="fas fa-chart-bar"></i> File Type Distribution</h3>
          <div class="file-types-grid">
            ${analysis.file_types.map((type, index) => {
              const maxCount = analysis.file_types[0].count;
              const percentage = (type.count / maxCount) * 100;
              return `
                <div class="file-type-card">
                  <div class="file-type-header">
                    <span class="file-type-rank">#${index + 1}</span>
                    <span class="file-type-ext">.${type.extension}</span>
                    <span class="file-type-count">${type.count.toLocaleString()}</span>
                  </div>
                  <div class="file-type-progress">
                    <div class="file-type-progress-bar" style="width: ${percentage}%"></div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
        
        <div class="analysis-section" id="analysis-summary">
          <h3><i class="fas fa-sitemap"></i> Directory Summary (Level 1)</h3>
          <div class="analysis-table-wrapper">
            <table class="modern-table">
              <thead>
                <tr>
                  <th width="120">Size</th>
                  <th>Path</th>
                </tr>
              </thead>
              <tbody>
                ${analysis.directory_summary.map(dir => `
                  <tr>
                    <td><span class="size-tag">${dir.size}</span></td>
                    <td><code class="path-code">${dir.path}</code></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
  
  overviewTab.innerHTML = html;
}

function switchAnalysisTab(event, tabName) {
  // Remove active from all tabs
  document.querySelectorAll('.analysis-tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.analysis-section').forEach(section => section.classList.remove('active'));
  
  // Add active to clicked tab
  event.target.classList.add('active');
  document.getElementById(`analysis-${tabName}`).classList.add('active');
}

function analyzeStorageInline(serverName, mountpoint) {
  const panel = document.getElementById("storage-analysis-panel");
  const content = document.getElementById("analysis-panel-content");
  const title = document.getElementById("analysis-panel-title"); // Show panel with loading
  panel.classList.add("show");
  title.textContent = `Analyzing ${mountpoint}...`;
  content.innerHTML = `
    <div class="analysis-loading">
      <div class="loading-spinner"></div>
      <p>Analyzing storage usage...</p>
    </div>
  `;
  fetch(`${API_BASE}/api/analyze_storage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      server: serverName,
      mountpoint: mountpoint,
    }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        displayStorageAnalysis(data);
      } else {
        content.innerHTML = `
        <div class="analysis-error">
          <i class="fas fa-exclamation-triangle fa-3x"></i>
          <p>Error: ${data.error || "Failed to analyze storage"}</p>
        </div>
      `;
      }
    })
    .catch((error) => {
      console.error("Error:", error);
      content.innerHTML = `
      <div class="analysis-error">
        <i class="fas fa-exclamation-triangle fa-3x"></i>
        <p>Failed to analyze storage</p>
      </div>
    `;
    });
}

function displayStorageAnalysis(data) {
  const title = document.getElementById("analysis-panel-title");
  const content = document.getElementById("analysis-panel-content");
  title.textContent = `${data.server} - ${data.mountpoint}`;
  const analysis = data.analysis;
  let html = `
    <div class="analysis-tabs-compact">
      <button class="analysis-tab-compact active" onclick="showAnalysisTabCompact(event, 'directories')">
        <i class="fas fa-folder"></i> Directories
      </button>
      <button class="analysis-tab-compact" onclick="showAnalysisTabCompact(event, 'files')">
        <i class="fas fa-file"></i> Files
      </button>
      <button class="analysis-tab-compact" onclick="showAnalysisTabCompact(event, 'types')">
        <i class="fas fa-chart-pie"></i> Types
      </button>
      <button class="analysis-tab-compact" onclick="showAnalysisTabCompact(event, 'summary')">
        <i class="fas fa-list"></i> Summary
      </button>
    </div>
    
    <div class="analysis-tab-content-compact active" id="analysis-compact-directories">
      <h4><i class="fas fa-folder-open"></i> Top 20 Largest Directories</h4>
      <div class="analysis-list">
        ${analysis.top_directories
    .map(
      (dir, index) => `
          <div class="analysis-item">
            <div class="analysis-rank">${index + 1}</div>
            <div class="analysis-details">
              <div class="analysis-size">${dir.size}</div>
              <div class="analysis-path">${dir.path}</div>
            </div>
          </div>
        `
    )
    .join("")}
      </div>
    </div>
    
    <div class="analysis-tab-content-compact" id="analysis-compact-files">
      <h4><i class="fas fa-file-alt"></i> Top 20 Largest Files</h4>
      <div class="analysis-list">
        ${analysis.top_files
    .map(
      (file, index) => `
          <div class="analysis-item">
            <div class="analysis-rank">${index + 1}</div>
            <div class="analysis-details">
              <div class="analysis-size">${file.size}</div>
              <div class="analysis-path">${file.path}</div>
            </div>
          </div>
        `
    )
    .join("")}
      </div>
    </div>
    
    <div class="analysis-tab-content-compact" id="analysis-compact-types">
      <h4><i class="fas fa-chart-bar"></i> File Type Distribution</h4>
      <div class="analysis-list">
        ${analysis.file_types
    .map((type, index) => {
      const maxCount = analysis.file_types[0].count;
      const percentage = (type.count / maxCount) * 100;
      return `
            <div class="analysis-item">
              <div class="analysis-rank">${index + 1}</div>
              <div class="analysis-details">
                <div class="file-type-info">
                  <span class="file-ext">.${
        type.extension
      }</span>
                  <span class="file-count">${type.count.toLocaleString()} files</span>
                </div>
                <div class="file-type-bar-compact">
                  <div class="file-type-fill-compact" style="width: ${percentage}%"></div>
                </div>
              </div>
            </div>
          `;
    })
    .join("")}
      </div>
    </div>
    
    <div class="analysis-tab-content-compact" id="analysis-compact-summary">
      <h4><i class="fas fa-sitemap"></i> Directory Summary</h4>
      <div class="analysis-list">
        ${analysis.directory_summary
    .map(
      (dir, index) => `
          <div class="analysis-item">
            <div class="analysis-details">
              <div class="analysis-size">${dir.size}</div>
              <div class="analysis-path">${dir.path}</div>
            </div>
          </div>
        `
    )
    .join("")}
      </div>
    </div>
  `;
  content.innerHTML = html;
}

function showAnalysisTabCompact(event, tabName) {
  // Remove active from all tabs and contents
  document
    .querySelectorAll(".analysis-tab-compact")
    .forEach((tab) => tab.classList.remove("active"));
  document
    .querySelectorAll(".analysis-tab-content-compact")
    .forEach((content) => content.classList.remove("active")); // Add active to selected
  event.target.closest(".analysis-tab-compact").classList.add("active");
  document
    .getElementById(`analysis-compact-${tabName}`)
    .classList.add("active");
}

function closeAnalysisPanel() {
  document.getElementById("storage-analysis-panel").classList.remove("show");
}

function renderProcessesTab(server) {
  document.getElementById("processes-tab").innerHTML =
    "<p>Loading processes...</p>";

  fetch(`${API_BASE}/api/user_services`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ server: server.name }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (!data.processes || data.processes.length === 0) {
        document.getElementById("processes-tab").innerHTML =
          "<p>No processes found</p>";
        return;
      }

      const html = `
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>IP</th>
                        <th>Login</th>
                        <th>TTY</th>
                        <th>PID</th>
                        <th>Command</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.processes
                      .map(
                        (proc) => `
                        <tr>
                            <td>${proc.user}</td>
                            <td>${proc.ip}</td>
                            <td>${proc.login_date} ${proc.login_time}</td>
                            <td>${proc.tty}</td>
                            <td>${proc.pid}</td>
                            <td><code>${proc.cmd}</code></td>
                        </tr>
                    `
                      )
                      .join("")}
                </tbody>
            </table>
        `;

      document.getElementById("processes-tab").innerHTML = html;
    })
    .catch((error) => {
      document.getElementById("processes-tab").innerHTML =
        "<p>Error loading processes</p>";
      console.error("Error:", error);
    });
}

function renderServicesTab(server) {
  const services = server.services || [];
  const failedServices = server.failed_services || [];

  if (services.length === 0 && failedServices.length === 0) {
    document.getElementById("services-tab").innerHTML =
      "<p>No services data available</p>";
    return;
  }

  let html = "";

  if (failedServices.length > 0) {
    html += `
            <div class="stat-section alert-section">
                <h3><i class="fas fa-exclamation-triangle"></i> Failed Services (${
                  failedServices.length
                })</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Status</th>
                            <th>Reason</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${failedServices
                          .map(
                            (service) => `
                            <tr class="warning-row">
                                <td><strong>${service.name}</strong></td>
                                <td><span class="status-badge offline">Failed</span></td>
                                <td>${service.reason}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
        `;
  }

  if (services.length > 0) {
    html += `
            <div class="stat-section">
                <h3><i class="fas fa-check-circle"></i> Running Services (${
                  services.length
                })</h3>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${services
                          .map(
                            (service) => `
                            <tr>
                                <td><strong>${service.name}</strong></td>
                                <td>${service.description || "N/A"}</td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            </div>
        `;
  }

  document.getElementById("services-tab").innerHTML = html;
}

function renderSSHTab(server) {
  if (!server.ssh_connections || server.ssh_connections.length === 0) {
    document.getElementById("ssh-tab").innerHTML =
      "<p>No active SSH connections</p>";
    return;
  }

  const html = `
        <table class="stats-table">
            <thead>
                <tr>
                    <th>User</th>
                    <th>IP Address</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                ${server.ssh_connections
                  .map(
                    (conn) => `
                    <tr>
                        <td><strong>${conn.user}</strong></td>
                        <td>${conn.ip}</td>
                        <td>
                            <button class="kick-btn" onclick="kickSSHUser('${server.name}', '${conn.ip}')">
                                <i class="fas fa-user-times"></i> Kick
                            </button>
                        </td>
                    </tr>
                `
                  )
                  .join("")}
            </tbody>
        </table>
    `;

  document.getElementById("ssh-tab").innerHTML = html;
}

function kickSSHUser(serverName, ip) {
  if (!confirm(`Are you sure you want to kick user from ${ip}?`)) return;

  showLoading();
  fetch(`${API_BASE}/api/kick_ssh`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ server: serverName, ip: ip }),
  })
    .then((response) => response.json())
    .then((data) => {
      hideLoading();
      if (data.success) {
        alert("User kicked successfully");
        showServerDetails(serverName);
      } else {
        alert("Failed to kick user: " + (data.error || "Unknown error"));
      }
    })
    .catch((error) => {
      hideLoading();
      console.error("Error:", error);
      alert("Error kicking user");
    });
}

// ==================== Alerts ====================
function loadAlerts() {
  fetch(`${API_BASE}/api/alerts`)
    .then((response) => response.json())
    .then((data) => {
      const container = document.getElementById("alerts-container");

      if (!data.alerts || data.alerts.length === 0) {
        container.innerHTML = `
                    <div class="no-alerts-state">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>All Systems Operational</h3>
                        <p>No alerts detected. All servers are running smoothly.</p>
                        <div class="alert-stats">
                            <div class="alert-stat-item">
                                <i class="fas fa-server"></i>
                                <span>${
                                  data.total_servers || 0
                                } Servers Monitored</span>
                            </div>
                        </div>
                    </div>
                `;
        return;
      }

      // Group alerts by type
      const alertsByType = {
        Offline: [],
        CPU: [],
        Memory: [],
        Storage: [],
      };

      data.alerts.forEach((alert) => {
        if (alertsByType[alert.type]) {
          alertsByType[alert.type].push(alert);
        }
      });

      let html = `
                <div class="alerts-summary">
                    <div class="summary-card critical">
                        <div class="summary-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value">${
                              data.alerts.length
                            }</div>
                            <div class="summary-label">Total Alerts</div>
                        </div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-icon">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value">${
                              data.alert_servers || 0
                            }</div>
                            <div class="summary-label">Affected Servers</div>
                        </div>
                    </div>
                    <div class="summary-card info">
                        <div class="summary-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value">${
                              alertsByType.CPU.length
                            }</div>
                            <div class="summary-label">CPU Alerts</div>
                        </div>
                    </div>
                    <div class="summary-card success">
                        <div class="summary-icon">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-value">${
                              alertsByType.Memory.length
                            }</div>
                            <div class="summary-label">Memory Alerts</div>
                        </div>
                    </div>
                </div>
                
                <div class="alerts-list">
            `;

      // Render alerts by type
      Object.keys(alertsByType).forEach((type) => {
        if (alertsByType[type].length > 0) {
          const typeIcons = {
            Offline: "fa-power-off",
            CPU: "fa-microchip",
            Memory: "fa-memory",
            Storage: "fa-hdd",
          };

          const typeColors = {
            Offline: "offline-alert",
            CPU: "cpu-alert",
            Memory: "memory-alert",
            Storage: "storage-alert",
          };

          html += `
                        <div class="alert-category">
                            <h3 class="category-header">
                                <i class="fas ${typeIcons[type]}"></i>
                                ${type} Alerts (${alertsByType[type].length})
                            </h3>
                            <div class="alert-items">
                                ${alertsByType[type]
                                  .map((alert) => {
                                    // Extract percentage from message if available
                                    const percentMatch =
                                      alert.message.match(/\((\d+\.?\d*)%\)/);
                                    const percentage = percentMatch
                                      ? parseFloat(percentMatch[1])
                                      : null;
                                    const severity =
                                      percentage >= 90
                                        ? "critical"
                                        : percentage >= 80
                                        ? "warning"
                                        : "moderate";

                                    return `
                                        <div class="alert-card ${
                                          typeColors[type]
                                        } ${severity}" onclick="showServerDetails('${
                                      alert.server
                                    }')">
                                            <div class="alert-indicator ${severity}"></div>
                                            <div class="alert-icon-circle">
                                                <i class="fas ${
                                                  typeIcons[type]
                                                }"></i>
                                            </div>
                                            <div class="alert-content">
                                                <div class="alert-header">
                                                    <h4 class="alert-server">${
                                                      alert.server
                                                    }</h4>
                                                    <span class="alert-time">${new Date().toLocaleTimeString()}</span>
                                                </div>
                                                <div class="alert-message">
                                                    <strong>${type}:</strong> ${
                                      alert.message
                                    }
                                                </div>
                                                ${
                                                  percentage
                                                    ? `
                                                    <div class="alert-progress">
                                                        <div class="progress-bar ${severity}">
                                                            <div class="progress-fill" style="width: ${percentage}%"></div>
                                                        </div>
                                                        <span class="progress-text">${percentage.toFixed(
                                                          1
                                                        )}%</span>
                                                    </div>
                                                `
                                                    : ""
                                                }
                                            </div>
                                            <div class="alert-action">
                                                <i class="fas fa-chevron-right"></i>
                                            </div>
                                        </div>
                                    `;
                                  })
                                  .join("")}
                            </div>
                        </div>
                    `;
        }
      });

      html += "</div>";
      container.innerHTML = html;
    })
    .catch((error) => {
      console.error("Error loading alerts:", error);
      document.getElementById("alerts-container").innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <h3>Error Loading Alerts</h3>
                    <p>Failed to fetch alert information.</p>
                </div>
            `;
    });
}

// ==================== Analytics with Highcharts ====================
function loadAnalytics() {
  fetch(`${API_BASE}/api/analytics`)
    .then((response) => response.json())
    .then((data) => {
      drawAnalyticsCharts(data);
    })
    .catch((error) => {
      console.error("Error loading analytics:", error);
    });
}

function loadAnalyticsByDateRange() {
  const fromDate = document.getElementById("date-from").value;
  const toDate = document.getElementById("date-to").value;

  if (!fromDate || !toDate) {
    alert("Please select both start and end date.");
    return;
  }

  fetch(`${API_BASE}/api/analytics_range?start=${fromDate}&end=${toDate}`)
    .then((res) => res.json())
    .then(drawAnalyticsCharts)
    .catch((e) => {
      console.error("Error fetching analytics data:", e);
      alert("Error fetching analytics data");
    });
}

function drawAnalyticsCharts(data) {
  if (!data || !data.length) {
    document.getElementById("cpuChart").innerHTML =
      '<p style="text-align: center; padding: 2rem; color: var(--text-secondary);"> No analytics data available. Data will appear after collecting metrics.</p>';
    document.getElementById("memoryChart").innerHTML =
      '<p style="text-align: center; padding: 2rem; color: var(--text-secondary);"> No analytics data available. Data will appear after collecting metrics.</p>';
    return;
  }

  const labels = data.map((d) =>
    new Date(d.timestamp).toLocaleString("en-US", {
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    })
  );

  const servers = [
    ...new Set(data.flatMap((d) => d.servers.map((s) => s.name))),
  ];

  const colors = [
    "#7cb5ec",
    "#434348",
    "#90ed7d",
    "#f7a35c",
    "#8085e9",
    "#f15c80",
    "#e4d354",
    "#2b908f",
    "#f45b5b",
    "#91e8e1",
  ];

  const cpuSeries = servers.map((serverName, idx) => ({
    name: serverName,
    data: data.map((d) => {
      const s = d.servers.find((s) => s.name === serverName);
      return s && s.cpu !== null ? s.cpu : null;
    }),
    color: colors[idx % colors.length],
    visible: true,
    lineWidth: 2,
    marker: {
      enabled: false,
      states: {
        hover: {
          enabled: true,
          radius: 5,
        },
      },
    },
  }));

  const memSeries = servers.map((serverName, idx) => ({
    name: serverName,
    data: data.map((d) => {
      const s = d.servers.find((s) => s.name === serverName);
      return s && s.memory_percent !== null ? s.memory_percent : null;
    }),
    color: colors[idx % colors.length],
    visible: true,
    lineWidth: 2,
    marker: {
      enabled: false,
      states: {
        hover: {
          enabled: true,
          radius: 5,
        },
      },
    },
  }));

  // CPU Chart
  Highcharts.chart("cpuChart", {
    chart: {
      type: "line",
      zoomType: "x",
      backgroundColor: "transparent",
      height: null, // Auto height
      spacingBottom: 80, // Add space for legend
      style: {
        fontFamily: "inherit",
      },
    },
    title: { text: null },
    xAxis: {
      categories: labels,
      labels: {
        rotation: -45,
        style: {
          fontSize: "11px",
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
      gridLineColor: "rgba(255, 255, 255, 0.05)",
    },
    yAxis: {
      title: {
        text: "CPU Usage (%)",
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-primary"
          ),
        },
      },
      min: 0,
      max: 100,
      gridLineColor: "rgba(255, 255, 255, 0.05)",
      labels: {
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
      plotLines: [
        {
          value: 70,
          color: "#f59e0b",
          label: {
            text: "Warning (70%)",
            style: { color: "#f59e0b" },
            align: "right",
            x: -10,
          },
          dashStyle: "ShortDash",
          width: 2,
          zIndex: 5,
        },
        {
          value: 90,
          color: "#ef4444",
          label: {
            text: "Critical (90%)",
            style: { color: "#ef4444" },
            align: "right",
            x: -10,
          },
          dashStyle: "ShortDash",
          width: 2,
          zIndex: 5,
        },
      ],
    },
    legend: {
      enabled: true,
      align: "center",
      verticalAlign: "bottom",
      layout: "horizontal",
      backgroundColor: "transparent",
      itemStyle: {
        color: getComputedStyle(document.body).getPropertyValue(
          "--text-primary"
        ),
        cursor: "pointer",
        fontSize: "13px",
        fontWeight: "500",
      },
      itemHoverStyle: {
        color: getComputedStyle(document.body).getPropertyValue("--accent"),
      },
      itemHiddenStyle: {
        color: getComputedStyle(document.body).getPropertyValue(
          "--text-secondary"
        ),
      },
      padding: 20,
      itemMarginBottom: 10,
      y: 20, // Push legend down
      floating: false,
      maxHeight: 100,
    },
    tooltip: {
      shared: true,
      valueSuffix: "%",
      crosshairs: true,
      backgroundColor: "rgba(0, 0, 0, 0.85)",
      borderColor: "rgba(255, 255, 255, 0.2)",
      borderWidth: 1,
      style: {
        color: "#fff",
        fontSize: "13px",
      },
      formatter: function () {
        let tooltip = "<b>" + this.x + "</b><br/>";
        this.points.forEach((point) => {
          if (point.y !== null) {
            tooltip +=
              '<span style="color:' +
              point.color +
              '"></span> ' +
              point.series.name +
              ": <b>" +
              point.y.toFixed(1) +
              "%</b><br/>";
          }
        });
        return tooltip;
      },
    },
    plotOptions: {
      series: {
        states: {
          hover: {
            lineWidthPlus: 1,
          },
        },
      },
    },
    series: cpuSeries,
    credits: { enabled: false },
  });

  // Memory Chart (same fixes)
  Highcharts.chart("memoryChart", {
    chart: {
      type: "line",
      zoomType: "x",
      backgroundColor: "transparent",
      height: null,
      spacingBottom: 80,
      style: {
        fontFamily: "inherit",
      },
    },
    title: { text: null },
    xAxis: {
      categories: labels,
      labels: {
        rotation: -45,
        style: {
          fontSize: "11px",
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
      gridLineColor: "rgba(255, 255, 255, 0.05)",
    },
    yAxis: {
      min: 0,
      max: 100,
      title: {
        text: "Memory Usage (%)",
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-primary"
          ),
        },
      },
      gridLineColor: "rgba(255, 255, 255, 0.05)",
      labels: {
        style: {
          color: getComputedStyle(document.body).getPropertyValue(
            "--text-secondary"
          ),
        },
      },
      plotLines: [
        {
          value: 75,
          color: "#f59e0b",
          label: {
            text: "Warning (75%)",
            style: { color: "#f59e0b" },
            align: "right",
            x: -10,
          },
          dashStyle: "ShortDash",
          width: 2,
          zIndex: 5,
        },
        {
          value: 90,
          color: "#ef4444",
          label: {
            text: "Critical (90%)",
            style: { color: "#ef4444" },
            align: "right",
            x: -10,
          },
          dashStyle: "ShortDash",
          width: 2,
          zIndex: 5,
        },
      ],
    },
    legend: {
      enabled: true,
      align: "center",
      verticalAlign: "bottom",
      layout: "horizontal",
      backgroundColor: "transparent",
      itemStyle: {
        color: getComputedStyle(document.body).getPropertyValue(
          "--text-primary"
        ),
        cursor: "pointer",
        fontSize: "13px",
        fontWeight: "500",
      },
      itemHoverStyle: {
        color: getComputedStyle(document.body).getPropertyValue("--accent"),
      },
      itemHiddenStyle: {
        color: getComputedStyle(document.body).getPropertyValue(
          "--text-secondary"
        ),
      },
      padding: 20,
      itemMarginBottom: 10,
      y: 20,
      floating: false,
      maxHeight: 100,
    },
    tooltip: {
      shared: true,
      valueSuffix: "%",
      crosshairs: true,
      backgroundColor: "rgba(0, 0, 0, 0.85)",
      borderColor: "rgba(255, 255, 255, 0.2)",
      borderWidth: 1,
      style: {
        color: "#fff",
        fontSize: "13px",
      },
      formatter: function () {
        let tooltip = "<b>" + this.x + "</b><br/>";
        this.points.forEach((point) => {
          if (point.y !== null) {
            tooltip +=
              '<span style="color:' +
              point.color +
              '"></span> ' +
              point.series.name +
              ": <b>" +
              point.y.toFixed(1) +
              "%</b><br/>";
          }
        });
        return tooltip;
      },
    },
    plotOptions: {
      series: {
        states: {
          hover: {
            lineWidthPlus: 1,
          },
        },
      },
    },
    series: memSeries,
    credits: { enabled: false },
  });
}

// ==================== User Tracking ====================
function loadUserTracking() {
  fetch(`${API_BASE}/api/user_tracking`)
    .then((res) => res.json())
    .then((data) => {
      const container = document.getElementById("user-tracking-container");

      if (!data.users || !data.users.length) {
        container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users fa-3x"></i>
                        <h3>No User Activity Yet</h3>
                        <p>User SSH tracking data will appear here once users connect to servers.</p>
                    </div>
                `;
        return;
      }

      // Filter out invalid IPs (like :pts/10:S.0, :1, tty2, :0, etc.)
      const validUsers = data.users.filter((user) => {
        const ip = user.user_ip;
        // Check if it's a valid IP format
        return /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(ip);
      });

      if (validUsers.length === 0) {
        container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users fa-3x"></i>
                        <h3>No External User Activity</h3>
                        <p>Only local/console sessions detected. External SSH connections will appear here.</p>
                    </div>
                `;
        return;
      }

      let html = `
                <div class="user-tracking-grid">
                    ${validUsers
                      .map((user) => {
                        const ipDisplay =
                          IP_NAME_MAP[user.user_ip] || user.user_ip;
                        const hasName = IP_NAME_MAP[user.user_ip] !== undefined;

                        return `
                            <div class="user-card">
                                <div class="user-card-header">
                                    <div class="user-icon">
                                        <i class="fas fa-user-circle"></i>
                                    </div>
                                    <div class="user-info">
                                        <h3 class="user-name">${
                                          user.user_name
                                        }</h3>
                                        <p class="user-ip">
                                            ${
                                              hasName
                                                ? `<span class="ip-badge named">${ipDisplay}</span>`
                                                : `<span class="ip-badge">${ipDisplay}</span>`
                                            }
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="user-stats">
                                    <div class="user-stat">
                                        <div class="stat-icon">
                                            <i class="fas fa-server"></i>
                                        </div>
                                        <div class="stat-content">
                                            <div class="stat-value">${
                                              user.total_servers
                                            }</div>
                                            <div class="stat-label">Servers</div>
                                        </div>
                                    </div>
                                    <div class="user-stat">
                                        <div class="stat-icon">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="stat-content">
                                            <div class="stat-value">${
                                              user.total_time_hours
                                            }h</div>
                                            <div class="stat-label">Total Time</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="server-sessions">
                                    <h4><i class="fas fa-list"></i> Server Sessions</h4>
                                   ${user.servers
                                     .map((srv) => {
                                       const firstSeen = new Date(
                                         srv.first_seen
                                       );
                                       const lastSeen = new Date(srv.last_seen);
                                       const duration =
                                         (lastSeen - firstSeen) / 1000 / 60; // minutes

                                       return `
                                            <div class="session-item">
                                                <div class="session-header">
                                                    <span class="server-name">${
                                                      srv.server_name
                                                    }</span>
                                                    <span class="session-count">${
                                                      srv.session_count
                                                    } ${
                                         srv.session_count === 1
                                           ? "session"
                                           : "sessions"
                                       }</span>
                                                </div>
                                                <div class="session-details">
                                                    <div class="session-time">
                                                        <i class="fas fa-sign-in-alt"></i>
                                                        Login: ${firstSeen.toLocaleString()}
                                                    </div>
                                                    <div class="session-time">
                                                        <i class="fas fa-clock"></i>
                                                        Last Seen: ${lastSeen.toLocaleString()}
                                                    </div>
                                                    <div class="session-time">
                                                        <i class="fas fa-hourglass-half"></i>
                                                        Duration: ${duration.toFixed(
                                                          1
                                                        )} minutes
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                     })
                                     .join("")}
                                </div>
                            </div>
                        `;
                      })
                      .join("")}
                </div>
            `;

      container.innerHTML = html;
    })
    .catch((error) => {
      console.error("Error loading user tracking:", error);
      document.getElementById("user-tracking-container").innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <h3>Error Loading Data</h3>
                    <p>Failed to load user tracking information.</p>
                </div>
            `;
    });
}

// ==================== All Servers ====================
function loadAllServers() {
  fetch(`${API_BASE}/api/status`)
    .then((response) => response.json())
    .then((data) => {
      const container = document.getElementById("all-servers-list");
      container.innerHTML = `
                <div class="servers-grid">
                    ${data.servers
                      .map((server) => {
                        const memory = validateMemoryData(server.memory);
                        const cpuStatus = getCPUStatus(server.cpu);
                        const cpuValue =
                          server.cpu !== null && server.cpu !== undefined
                            ? server.cpu.toFixed(1) + "%"
                            : "N/A";
                        const cpuPercent = server.cpu || 0;

                        const memValue = memory
                          ? calculateMemoryPercent(
                              memory.used,
                              memory.total
                            ).toFixed(1) + "%"
                          : "N/A";
                        const memPercent = memory
                          ? calculateMemoryPercent(memory.used, memory.total)
                          : 0;
                        const memStatus = memory ? memory.status : "";

                        // Get ROOT storage
                        let storageValue = "N/A";
                        let storagePercent = 0;
                        let storageStatus = "";

                        if (server.storage && server.storage.length > 0) {
                          const rootStorage = server.storage.find(
                            (s) =>
                              s.mountpoint === "/" || s.mountpoint === "/root"
                          );
                          if (
                            rootStorage &&
                            rootStorage.percent !== null &&
                            rootStorage.percent !== undefined
                          ) {
                            storagePercent = rootStorage.percent;
                            storageValue = storagePercent.toFixed(1) + "%";
                            storageStatus = rootStorage.status || "";
                          }
                        }

                        // Blink classes
                        const cpuBlinkClass =
                          cpuPercent >= 90
                            ? "blink-critical"
                            : cpuPercent >= 70
                            ? "blink-warning"
                            : "";
                        const memBlinkClass =
                          memPercent >= 90
                            ? "blink-critical"
                            : memPercent >= 75
                            ? "blink-warning"
                            : "";
                        const storageBlinkClass =
                          storagePercent >= 90
                            ? "blink-critical"
                            : storagePercent >= 80
                            ? "blink-warning"
                            : "";

                        return `
                            <div class="server-card ${server.status}" onclick="showServerDetails('${server.name}')">
                                <div class="server-header">
                                    <h3>${server.name}</h3>
                                    <span class="status-badge ${server.status}">${server.status}</span>
                                </div>
                                <div class="server-stats">
                                    <div class="stat ${cpuBlinkClass}">
                                        <span class="stat-label">CPU</span>
                                        <span class="stat-value ${cpuStatus}">${cpuValue}</span>
                                    </div>
                                    <div class="stat ${memBlinkClass}">
                                        <span class="stat-label">Memory</span>
                                        <span class="stat-value ${memStatus}">${memValue}</span>
                                    </div>
                                    <div class="stat ${storageBlinkClass}">
                                        <span class="stat-label">Storage</span>
                                        <span class="stat-value ${storageStatus}">${storageValue}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                      })
                      .join("")}
                </div>
            `;
    });
}

// ==================== Loading ====================
function showLoading() {
  document.getElementById("loading").classList.add("show");
}

function hideLoading() {
  document.getElementById("loading").classList.remove("show");
}

// ==================== Search ====================
function initSearch() {
  const searchInput = document.getElementById("serverSearch");
  searchInput.addEventListener("input", (e) => {
    const query = e.target.value.toLowerCase();
    const cards = document.querySelectorAll(".server-card");

    cards.forEach((card) => {
      const name = card.querySelector("h3").textContent.toLowerCase();
      if (name.includes(query)) {
        card.style.display = "block";
      } else {
        card.style.display = "none";
      }
    });
  });
}

// ==================== Initialize ====================
document.addEventListener("DOMContentLoaded", () => {
  initNavigation();
  initSidebarToggle();
  initThemeSwitcher();
  initSearch();
  loadSettings();

  updateTimeDisplay();
  updateServers();

  setInterval(updateTimeDisplay, 1000);
  window.refreshTimer = setInterval(updateServers, refreshInterval);

  document.getElementById("server-modal").addEventListener("click", (e) => {
    if (e.target.id === "server-modal") {
      closeModal();
    }
  });
});
