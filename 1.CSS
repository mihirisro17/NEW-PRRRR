/* ==================== ROOT VARIABLES ==================== */
:root {
    --accent-rgb: 102, 126, 234;
}

.theme-dark {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border: #334155;
    --shadow: rgba(0, 0, 0, 0.5);
    --accent: #667eea;
    --accent-hover: #5a67d8;
}

.theme-light {
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-tertiary: #e2e8f0;
    --text-primary: #0f172a;
    --text-secondary: #64748b;
    --border: #e2e8f0;
    --shadow: rgba(0, 0, 0, 0.1);
    --accent: #667eea;
    --accent-hover: #5a67d8;
}

.theme-blue {
    --bg-primary: #0c1e35;
    --bg-secondary: #1a2f4a;
    --bg-tertiary: #2a4365;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --border: #2a4365;
    --shadow: rgba(0, 0, 0, 0.5);
    --accent: #3b82f6;
    --accent-hover: #2563eb;
}






function renderStorageTab(server) {
    if (!server.storage || server.storage.length === 0) {
        document.getElementById('storage-tab').innerHTML = `
            <div class="empty-storage-state">
                <i class="fas fa-hdd fa-4x"></i>
                <h3>No Storage Data</h3>
                <p>Storage information is not available for this server</p>
            </div>
        `;
        return;
    }
    
    const html = `
        <div class="storage-header-section">
            <h3><i class="fas fa-database"></i> Storage Overview</h3>
            <div class="storage-stats-summary">
                <div class="storage-summary-item">
                    <i class="fas fa-hdd"></i>
                    <span>${server.storage.length} Partitions</span>
                </div>
                <div class="storage-summary-item">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${server.storage.filter(s => s.status !== 'normal').length} Alerts</span>
                </div>
            </div>
        </div>
        
        <div class="storage-cards-grid">
            ${server.storage.map((drive, index) => {
                const usedPercent = drive.percent || 0;
                
                return `
                    <div class="storage-card-modern ${drive.status}">
                        <div class="storage-card-header">
                            <div class="storage-icon-wrapper">
                                <i class="fas ${drive.mountpoint === '/' ? 'fa-hard-drive' : 'fa-folder'}"></i>
                            </div>
                            <div class="storage-title-section">
                                <h4>${drive.mountpoint}</h4>
                                <span class="storage-filesystem">${drive.filesystem}</span>
                            </div>
                            <span class="storage-status-badge ${drive.status}">
                                ${drive.status}
                            </span>
                        </div>
                        
                        <div class="storage-visualization">
                            <canvas id="storage-chart-${index}" class="storage-mini-chart"></canvas>
                            <div class="storage-center-info">
                                <div class="storage-percent-large">${usedPercent.toFixed(1)}%</div>
                                <div class="storage-percent-label">Used</div>
                            </div>
                        </div>
                        
                        <div class="storage-details-grid">
                            <div class="storage-detail-item">
                                <i class="fas fa-database"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Total</span>
                                    <span class="storage-detail-value">${formatBytes(drive.size)}</span>
                                </div>
                            </div>
                            <div class="storage-detail-item">
                                <i class="fas fa-chart-pie"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Used</span>
                                    <span class="storage-detail-value">${formatBytes(drive.used)}</span>
                                </div>
                            </div>
                            <div class="storage-detail-item">
                                <i class="fas fa-check-circle"></i>
                                <div class="storage-detail-content">
                                    <span class="storage-detail-label">Free</span>
                                    <span class="storage-detail-value">${formatBytes(drive.available)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="storage-progress-bar">
                            <div class="storage-progress-fill ${drive.status}" style="width: ${usedPercent}%">
                                <span class="storage-progress-text">${usedPercent.toFixed(1)}%</span>
                            </div>
                        </div>
                        
                        <button class="storage-analyze-btn" onclick="analyzeStorage('${server.name}', '${drive.mountpoint}')">
                            <i class="fas fa-search-plus"></i>
                            <span>Analyze Storage</span>
                        </button>
                    </div>
                `;
            }).join('')}
        </div>
    `;
    
    document.getElementById('storage-tab').innerHTML = html;
    
    // Draw mini charts for each storage
    server.storage.forEach((drive, index) => {
        setTimeout(() => {
            drawStorageMiniChart(index, drive.percent, drive.status);
        }, 100);
    });
}

function drawStorageMiniChart(index, usedPercent, status) {
    const canvas = document.getElementById(`storage-chart-${index}`);
    if (!canvas) {
        console.error(`Canvas not found: storage-chart-${index}`);
        return;
    }
    
    const ctx = canvas.getContext('2d');
    canvas.width = 160;
    canvas.height = 160;
    
    const freePercent = 100 - usedPercent;
    
    // Color based on status
    let usedColor = '#10b981'; // green
    let freeColor = '#e5e7eb';
    
    if (status === 'critical') {
        usedColor = '#ef4444'; // red
    } else if (status === 'warning') {
        usedColor = '#f59e0b'; // orange
    } else if (status === 'moderate') {
        usedColor = '#3b82f6'; // blue
    }
    
    // Check if Chart is defined
    if (typeof Chart === 'undefined') {
        console.error('Chart.js is not loaded!');
        // Draw simple text fallback
        ctx.fillStyle = '#fff';
        ctx.font = '20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`${usedPercent.toFixed(1)}%`, 80, 80);
        return;
    }
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Used', 'Free'],
            datasets: [{
                data: [usedPercent, freePercent],
                backgroundColor: [usedColor, freeColor],
                borderWidth: 0
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            cutout: '75%',
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
            }
        }
    });
}


