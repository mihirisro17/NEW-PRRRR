from flask import Flask, render_template, jsonify, request
import requests
from datetime import datetime, timedelta
import time
from concurrent.futures import ThreadPoolExecutor, as_completed
import threading
import json
import os

app = Flask(__name__, 
            static_url_path='/geoentity_monitoring/static',
            static_folder='static',
            template_folder='templates')

BASE_URL = "https://vedas.sac.gov.in/geoentity-services/api"
RESULTS_FILE = "filter_check_results.json"

class APIMonitor:
    def __init__(self):
        self.results = {
            'sources': {},
            'geoentities': {},
            'last_check': None
        }
        self.filter_check_results = self.load_results()
        self.filter_check_status = {
            'running': False,
            'progress': 0,
            'total': 0,
            'current_source': None,
            'current_entity': None,
            'completed_sources': 0,
            'total_sources': 0
        }
        self.last_daily_check = self.get_last_daily_check()
        self.start_daily_check_thread()
    
    def load_results(self):
        """Load saved filter check results"""
        if os.path.exists(RESULTS_FILE):
            try:
                with open(RESULTS_FILE, 'r') as f:
                    return json.load(f)
            except:
                return {}
        return {}
    
    def save_results(self):
        """Save filter check results to file"""
        try:
            with open(RESULTS_FILE, 'w') as f:
                json.dump(self.filter_check_results, f, indent=2)
        except Exception as e:
            print(f"Error saving results: {e}")
    
    def get_last_daily_check(self):
        """Get last daily check timestamp"""
        if os.path.exists('last_daily_check.txt'):
            try:
                with open('last_daily_check.txt', 'r') as f:
                    return datetime.fromisoformat(f.read().strip())
            except:
                return None
        return None
    
    def save_last_daily_check(self):
        """Save last daily check timestamp"""
        try:
            with open('last_daily_check.txt', 'w') as f:
                f.write(datetime.now().isoformat())
        except Exception as e:
            print(f"Error saving timestamp: {e}")
    
    def start_daily_check_thread(self):
        """Start background thread for daily checks"""
        def daily_check_worker():
            while True:
                try:
                    now = datetime.now()
                    if self.last_daily_check is None or (now - self.last_daily_check) > timedelta(days=1):
                        print(f"Starting daily filter check at {now}")
                        self.run_all_filter_checks()
                        self.last_daily_check = now
                        self.save_last_daily_check()
                        print(f"Daily filter check completed at {datetime.now()}")
                    time.sleep(3600)
                except Exception as e:
                    print(f"Error in daily check: {e}")
                    time.sleep(3600)
        
        thread = threading.Thread(target=daily_check_worker, daemon=True)
        thread.start()
        print("Daily check thread started")
    
    def check_sources_api(self):
        """Check the geoentity sources API"""
        url = f"{BASE_URL}/geoentity-sources/"
        start_time = time.time()
        
        try:
            response = requests.get(url, timeout=10)
            response_time = round((time.time() - start_time) * 1000, 2)
            
            return {
                'status': 'success' if response.status_code == 200 else 'error',
                'status_code': response.status_code,
                'response_time': response_time,
                'data': response.json() if response.status_code == 200 else None,
                'error': None,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
        except Exception as e:
            return {
                'status': 'error',
                'status_code': None,
                'response_time': round((time.time() - start_time) * 1000, 2),
                'data': None,
                'error': str(e),
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
    
    def check_geoentity_api(self, source_id, source_name, category, project):
        """Check individual geoentity API"""
        url = f"{BASE_URL}/geoentity-sources/{source_id}/geoentities"
        start_time = time.time()
        
        try:
            response = requests.get(url, timeout=10)
            response_time = round((time.time() - start_time) * 1000, 2)
            
            return {
                'id': source_id,
                'name': source_name,
                'category': category,
                'project': project,
                'status': 'success' if response.status_code == 200 else 'error',
                'status_code': response.status_code,
                'response_time': response_time,
                'count': response.json().get('count', 0) if response.status_code == 200 else 0,
                'error': None,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
                'url': url
            }
        except Exception as e:
            return {
                'id': source_id,
                'name': source_name,
                'category': category,
                'project': project,
                'status': 'error',
                'status_code': None,
                'response_time': round((time.time() - start_time) * 1000, 2),
                'count': 0,
                'error': str(e),
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
                'url': url
            }
    
    def run_full_check(self):
        """Run complete monitoring check"""
        sources_result = self.check_sources_api()
        self.results['sources'] = sources_result
        
        if sources_result['status'] == 'success' and sources_result['data']:
            sources = sources_result['data'].get('data', [])
            
            geoentity_results = []
            with ThreadPoolExecutor(max_workers=10) as executor:
                futures = {
                    executor.submit(
                        self.check_geoentity_api, 
                        source['id'], 
                        source['name'],
                        source.get('category', 'N/A'),
                        source.get('project', 'N/A')
                    ): source for source in sources
                }
                
                for future in as_completed(futures):
                    try:
                        result = future.result()
                        geoentity_results.append(result)
                    except Exception as e:
                        source = futures[future]
                        geoentity_results.append({
                            'id': source['id'],
                            'name': source['name'],
                            'category': source.get('category', 'N/A'),
                            'project': source.get('project', 'N/A'),
                            'status': 'error',
                            'error': str(e)
                        })
            
            self.results['geoentities'] = sorted(geoentity_results, key=lambda x: x['id'])
        
        self.results['last_check'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        return self.results
    
    def check_geoentity_with_prefix(self, source_id, geoentity_id):
        """Check geoentity with prefix parameter"""
        url = f"{BASE_URL}/geoentity-sources/{source_id}/geoentities?prefix={geoentity_id}"
        start_time = time.time()
        
        try:
            response = requests.get(url, timeout=10)
            response_time = round((time.time() - start_time) * 1000, 2)
            
            return {
                'source_id': source_id,
                'geoentity_id': geoentity_id,
                'status': 'success' if response.status_code == 200 else 'error',
                'status_code': response.status_code,
                'response_time': response_time,
                'count': response.json().get('count', 0) if response.status_code == 200 else 0,
                'url': url,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
        except Exception as e:
            return {
                'source_id': source_id,
                'geoentity_id': geoentity_id,
                'status': 'error',
                'error': str(e),
                'response_time': round((time.time() - start_time) * 1000, 2),
                'url': url,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
    
    def check_geoentity_with_bbox(self, source_id, bbox="72.450,22.880,72.700,23.125"):
        """Check geoentity with bbox parameter"""
        url = f"{BASE_URL}/geoentity-sources/{source_id}/geoentities?bbox={bbox}&parents=1"
        start_time = time.time()
        
        try:
            response = requests.get(url, timeout=10)
            response_time = round((time.time() - start_time) * 1000, 2)
            
            return {
                'source_id': source_id,
                'bbox': bbox,
                'status': 'success' if response.status_code == 200 else 'error',
                'status_code': response.status_code,
                'response_time': response_time,
                'count': response.json().get('count', 0) if response.status_code == 200 else 0,
                'url': url,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
        except Exception as e:
            return {
                'source_id': source_id,
                'bbox': bbox,
                'status': 'error',
                'error': str(e),
                'response_time': round((time.time() - start_time) * 1000, 2),
                'url': url,
                'timestamp': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            }
    
    def run_single_filter_check(self, source_id):
        """Run filter check for a single source"""
        source_key = f"source_{source_id}"
        print(f"[{datetime.now().strftime('%H:%M:%S')}] Starting filter check for source {source_id}")
        
        self.filter_check_results[source_key] = {
            'source_id': source_id,
            'started_at': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
            'status': 'running',
            'checks': []
        }
        
        try:
            if source_id in [15, 26, 28]:
                print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Using bbox check")
                self.filter_check_status['current_source'] = f"Source {source_id} (bbox check)"
                result = self.check_geoentity_with_bbox(source_id)
                self.filter_check_results[source_key]['checks'].append(result)
                self.filter_check_results[source_key]['type'] = 'bbox'
                print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Bbox check completed")
            else:
                print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Fetching geoentities list...")
                url = f"{BASE_URL}/geoentity-sources/{source_id}/geoentities"
                response = requests.get(url, timeout=30)
                
                if response.status_code == 200:
                    data = response.json()
                    geoentities = data.get('data', [])
                    total = len(geoentities)
                    
                    print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Found {total} geoentities")
                    
                    self.filter_check_status['total'] = total
                    self.filter_check_results[source_key]['type'] = 'prefix'
                    self.filter_check_results[source_key]['total_entities'] = total
                    
                    for idx, entity in enumerate(geoentities):
                        geoentity_id = entity.get('geoentity_id')
                        self.filter_check_status['current_entity'] = geoentity_id
                        self.filter_check_status['progress'] = idx + 1
                        
                        if (idx + 1) % 100 == 0 or idx == 0:
                            print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Progress {idx+1}/{total}")
                        
                        result = self.check_geoentity_with_prefix(source_id, geoentity_id)
                        result['entity_name'] = entity.get('name', 'N/A')
                        result['parent_name'] = entity.get('parent_name', 'N/A')
                        
                        self.filter_check_results[source_key]['checks'].append(result)
                        time.sleep(0.05)
                    
                    print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Completed all {total} checks")
                else:
                    print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: ERROR - Got status code {response.status_code}")
                    self.filter_check_results[source_key]['status'] = 'error'
                    self.filter_check_results[source_key]['error'] = f"Failed to fetch geoentities: {response.status_code}"
                    self.save_results()
                    return
            
            # Mark as completed - IMPORTANT FIX
            self.filter_check_results[source_key]['status'] = 'completed'
            self.filter_check_results[source_key]['completed_at'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: COMPLETED")
            
        except Exception as e:
            print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: EXCEPTION - {str(e)}")
            self.filter_check_results[source_key]['status'] = 'error'
            self.filter_check_results[source_key]['error'] = str(e)
            self.filter_check_results[source_key]['completed_at'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        
        # Save results after each source
        self.save_results()
        print(f"[{datetime.now().strftime('%H:%M:%S')}] Source {source_id}: Results saved to file")
    
    def run_all_filter_checks(self):
        """Run filter checks for all sources"""
        if self.filter_check_status['running']:
            return {'error': 'A filter check is already running'}
        
        self.filter_check_status['running'] = True
        self.filter_check_status['progress'] = 0
        
        try:
            print(f"[{datetime.now().strftime('%H:%M:%S')}] Starting run_all_filter_checks")
            
            sources_result = self.check_sources_api()
            
            if sources_result['status'] == 'success' and sources_result['data']:
                sources = sources_result['data'].get('data', [])
                total_sources = len(sources)
                
                print(f"[{datetime.now().strftime('%H:%M:%S')}] Found {total_sources} sources to check")
                
                self.filter_check_status['total_sources'] = total_sources
                self.filter_check_status['completed_sources'] = 0
                
                for idx, source in enumerate(sources):
                    source_id = source['id']
                    source_name = source.get('name', 'Unknown')
                    
                    self.filter_check_status['current_source'] = f"Source {source_id}: {source_name}"
                    self.filter_check_status['completed_sources'] = idx
                    
                    print(f"[{datetime.now().strftime('%H:%M:%S')}] === Checking source {source_id} ({idx+1}/{total_sources}) - {source_name} ===")
                    
                    try:
                        self.run_single_filter_check(source_id)
                    except Exception as e:
                        print(f"[{datetime.now().strftime('%H:%M:%S')}] ERROR checking source {source_id}: {e}")
                        continue
                
                self.filter_check_status['completed_sources'] = total_sources
                print(f"[{datetime.now().strftime('%H:%M:%S')}] === All filter checks completed! ===")
                
            else:
                print(f"[{datetime.now().strftime('%H:%M:%S')}] ERROR: Failed to get sources list")
                
        except Exception as e:
            print(f"[{datetime.now().strftime('%H:%M:%S')}] CRITICAL ERROR in run_all_filter_checks: {e}")
            import traceback
            traceback.print_exc()
        
        finally:
            self.filter_check_status['running'] = False
            self.filter_check_status['progress'] = 0
            self.filter_check_status['current_source'] = None
            self.filter_check_status['current_entity'] = None
            print(f"[{datetime.now().strftime('%H:%M:%S')}] Filter check process ended")

monitor = APIMonitor()

@app.route('/geoentity_monitoring/')
def index():
    return render_template('dashboard.html')

@app.route('/geoentity_monitoring/api/check', methods=['GET'])
def check_apis():
    results = monitor.run_full_check()
    return jsonify(results)

@app.route('/geoentity_monitoring/api/stats', methods=['GET'])
def get_stats():
    if not monitor.results.get('geoentities'):
        return jsonify({'error': 'No data available'})
    
    geoentities = monitor.results['geoentities']
    total = len(geoentities)
    success = sum(1 for g in geoentities if g['status'] == 'success')
    failed = total - success
    avg_response = sum(g['response_time'] for g in geoentities) / total if total > 0 else 0
    
    return jsonify({
        'total_endpoints': total,
        'success': success,
        'failed': failed,
        'success_rate': round((success / total * 100), 2) if total > 0 else 0,
        'avg_response_time': round(avg_response, 2)
    })

@app.route('/geoentity_monitoring/api/filter-check/start/<int:source_id>', methods=['POST'])
def start_filter_check(source_id):
    """Start detailed filter check for a source"""
    if monitor.filter_check_status['running']:
        return jsonify({'error': 'A filter check is already running'}), 400
    
    def run_single():
        monitor.filter_check_status['running'] = True
        monitor.run_single_filter_check(source_id)
        monitor.filter_check_status['running'] = False
    
    thread = threading.Thread(target=run_single, daemon=True)
    thread.start()
    
    return jsonify({
        'status': 'started',
        'source_id': source_id,
        'message': 'Filter check started in background'
    })

@app.route('/geoentity_monitoring/api/filter-check/start-all', methods=['POST'])
def start_all_filter_checks():
    """Start filter check for all sources"""
    if monitor.filter_check_status['running']:
        return jsonify({'error': 'A filter check is already running'}), 400
    
    thread = threading.Thread(target=monitor.run_all_filter_checks, daemon=True)
    thread.start()
    
    return jsonify({
        'status': 'started',
        'message': 'Filter check started for all sources'
    })

@app.route('/geoentity_monitoring/api/filter-check/status', methods=['GET'])
def get_filter_check_status():
    """Get status of current filter check"""
    status = monitor.filter_check_status.copy()
    status['last_daily_check'] = monitor.last_daily_check.strftime('%Y-%m-%d %H:%M:%S') if monitor.last_daily_check else 'Never'
    return jsonify(status)

@app.route('/geoentity_monitoring/api/filter-check/summary', methods=['GET'])
def get_filter_check_summary():
    """Get summary of all filter check results (lightweight)"""
    summary = {}
    
    for key, result in monitor.filter_check_results.items():
        source_id = result.get('source_id')
        checks = result.get('checks', [])
        
        success_count = sum(1 for c in checks if c.get('status') == 'success')
        fail_count = len(checks) - success_count
        
        total_response_time = sum(c.get('response_time', 0) for c in checks)
        avg_response_time = round(total_response_time / len(checks), 2) if checks else 0
        
        summary[key] = {
            'source_id': source_id,
            'type': result.get('type', 'unknown'),
            'status': result.get('status'),
            'started_at': result.get('started_at'),
            'completed_at': result.get('completed_at'),
            'total_checks': len(checks),
            'success_count': success_count,
            'fail_count': fail_count,
            'avg_response_time': avg_response_time,
            'total_entities': result.get('total_entities', 0)
        }
    
    return jsonify(summary)

@app.route('/geoentity_monitoring/api/filter-check/result/<int:source_id>/paginated', methods=['GET'])
def get_paginated_results(source_id):
    """Get paginated results for a specific source"""
    page = request.args.get('page', 1, type=int)
    per_page = request.args.get('per_page', 50, type=int)
    
    source_key = f"source_{source_id}"
    
    if source_key not in monitor.filter_check_results:
        return jsonify({'error': 'No results found'}), 404
    
    result = monitor.filter_check_results[source_key]
    checks = result.get('checks', [])
    
    total = len(checks)
    start = (page - 1) * per_page
    end = start + per_page
    
    paginated_checks = checks[start:end]
    
    return jsonify({
        'source_id': source_id,
        'type': result.get('type'),
        'status': result.get('status'),
        'started_at': result.get('started_at'),
        'completed_at': result.get('completed_at'),
        'checks': paginated_checks,
        'pagination': {
            'page': page,
            'per_page': per_page,
            'total': total,
            'total_pages': (total + per_page - 1) // per_page,
            'has_next': end < total,
            'has_prev': page > 1
        }
    })

if __name__ == '__main__':
    print("=" * 60)
    print("GeoEntity Monitoring Server Starting...")
    print("=" * 60)
    print(f"Server: http://127.0.0.1:1115/geoentity_monitoring/")
    print(f"Daily auto-check: Enabled")
    if monitor.last_daily_check:
        print(f"Last daily check: {monitor.last_daily_check.strftime('%Y-%m-%d %H:%M:%S')}")
    else:
        print(f"Last daily check: Never (will run soon)")
    print("=" * 60)
    app.run(debug=True, host='0.0.0.0', port=1115)









<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoEntity Services Monitor - SAC VEDAS</title>
    <link rel="stylesheet" href="/geoentity_monitoring/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-animation">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="title-section">
                    <div class="logo">üõ∞Ô∏è</div>
                    <div>
                        <h1>GeoEntity Services Monitor</h1>
                        <p>Real-time monitoring of SAC VEDAS GeoEntity API endpoints</p>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="runCheck()">
                        <span class="btn-icon">üîÑ</span>
                        <span>Run Check Now</span>
                    </button>
                    <div class="auto-refresh">
                        <label class="switch">
                            <input type="checkbox" id="autoRefresh" onchange="toggleAutoRefresh()">
                            <span class="slider"></span>
                        </label>
                        <span class="refresh-label">Auto-refresh</span>
                        <select id="refreshInterval">
                            <option value="30">30s</option>
                            <option value="60" selected>1 min</option>
                            <option value="300">5 min</option>
                            <option value="600">10 min</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('basic')">
                <span>üìä</span> Basic Monitoring
            </button>
            <button class="tab-btn" onclick="switchTab('filter')">
                <span>üîç</span> Filter Checking
                <span class="badge-small" id="filterCheckBadge" style="display:none;">Running</span>
            </button>
        </div>

        <div id="basicTab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalEndpoints">-</div>
                        <div class="stat-label">Total Endpoints</div>
                    </div>
                </div>
                <div class="stat-card stat-success">
                    <div class="stat-icon">‚úì</div>
                    <div class="stat-content">
                        <div class="stat-value" id="successCount">-</div>
                        <div class="stat-label">Success</div>
                    </div>
                </div>
                <div class="stat-card stat-error">
                    <div class="stat-icon">‚úó</div>
                    <div class="stat-content">
                        <div class="stat-value" id="failedCount">-</div>
                        <div class="stat-label">Failed</div>
                    </div>
                </div>
                <div class="stat-card stat-rate">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-content">
                        <div class="stat-value" id="successRate">-</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-content">
                        <div class="stat-value" id="avgResponse">-</div>
                        <div class="stat-label">Avg Response (ms)</div>
                    </div>
                </div>
            </div>

            <div class="main-status">
                <div class="section-header">
                    <h2>
                        <span class="status-indicator loading" id="mainStatus"></span>
                        Main API Endpoint Status
                    </h2>
                </div>
                <div id="mainApiStatus" class="api-status-content">
                    <p class="placeholder-text">Click "Run Check Now" to start monitoring</p>
                </div>
            </div>

            <div class="main-status">
                <div class="section-header">
                    <h2>GeoEntity Endpoints</h2>
                </div>
                <div class="filter-controls">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchBox" placeholder="Search by name, category, or project..." onkeyup="filterEndpoints()">
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">
                            <span>All</span>
                        </button>
                        <button class="filter-btn" data-filter="success" onclick="setFilter('success')">
                            <span>‚úì Success</span>
                        </button>
                        <button class="filter-btn" data-filter="error" onclick="setFilter('error')">
                            <span>‚úó Failed</span>
                        </button>
                    </div>
                </div>
                <div class="endpoints-grid" id="endpointsGrid">
                    <p class="placeholder-text">Waiting for data...</p>
                </div>
            </div>
        </div>

        <div id="filterTab" class="tab-content">
            <div class="main-status">
                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2>üîç Detailed Filter Checking</h2>
                        <p style="color: #718096; font-size: 14px; margin-top: 8px;">
                            Check each geoentity with prefix parameter or bbox for specific sources
                        </p>
                        <p style="color: #718096; font-size: 13px; margin-top: 4px;" id="lastDailyCheck">
                            Last auto-check: Loading...
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="runAllFilterChecks()" id="runAllBtn">
                        <span>üöÄ</span> Run All Sources
                    </button>
                </div>

                <div id="filterCheckStatus" class="filter-status-box" style="display:none;">
                    <div class="progress-container">
                        <div class="progress-info">
                            <span id="filterStatusText">Initializing...</span>
                            <span id="filterProgress">0/0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="filterProgressBar"></div>
                        </div>
                        <div class="current-check" id="currentCheckInfo"></div>
                    </div>
                </div>

                <div id="filterSummaryGrid" class="stats-grid" style="margin-top: 20px;">
                    <p class="placeholder-text">Loading summary...</p>
                </div>
            </div>
        </div>

        <div class="last-updated" id="lastUpdated">
            <span class="update-icon">üïê</span>
            <span id="lastUpdateText">Not checked yet</span>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Checking endpoints...</p>
        </div>
    </div>

    <div id="detailModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Source Details</h3>
                <button class="btn-close" onclick="closeDetailModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody">
                Loading...
            </div>
            <div class="modal-footer">
                <div id="paginationControls"></div>
                <button class="btn btn-secondary" onclick="closeDetailModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/geoentity_monitoring/static/js/dashboard.js"></script>
</body>
</html>





